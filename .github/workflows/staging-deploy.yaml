name: Deploy config to DB

on:
  push:
    branches:
      - develop
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout current develop
        uses: actions/checkout@v3
        with:
          ref: develop
      - name: Set Node 16
        uses: actions/setup-node@v3
        with:
          node-version: 16
      - name: Install dependencies
        run: npm install
      - name: Run tests
        run: npm run test
      - name: Install python
        uses: actions/setup-python@v4
        with:
            python-version: '3.9.13'
      - name: Setup Python
        run: python -m pip install --upgrade pip requests jsondiff
      - name: Display Python version
        run: python -c "import sys; print(sys.version)"
      - name: Display current location files
        run: |
         echo current directory
         ls -a
         pwd
         which python
      - name: Display current Version of Config-Schema
        run: echo $(head -1 .version)
      - name: Get current date
        id: date
        run: echo "::set-output name=date::$(date +'%Y-%m-%dT%H:%M:%S')"
      - name: Overwrite file
        uses: "DamianReeves/write-file-action@master"
        with:
          path: staging-deploy.html
          write-mode: append
          contents: |
            console.log('\n dev deployment happened at ${{ steps.date.outputs.date }} on $GITHUB_REF')
            
      - name: Commit & Push
        uses: Andro999b/push@v1.3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          branch: develop
          force: true
          message: 'Overwritten by Github Actions - ${date}'


