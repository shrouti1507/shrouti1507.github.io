{"version":3,"file":"Lemnisk.min.js","sources":["../../../src/utils/logger.js","../../../src/integrations/Lemnisk/constants.js","../../../src/integrations/Lemnisk/browser.js","../../../src/utils/ScriptLoader.js"],"sourcesContent":["const LogLevel = {\n  LOG: {\n    value: 0,\n    method: console.log,\n  },\n  INFO: {\n    value: 1,\n    method: console.info,\n  },\n  DEBUG: {\n    value: 2,\n    method: console.debug,\n  },\n  WARN: {\n    value: 3,\n    method: console.warn,\n  },\n  ERROR: {\n    value: 4,\n    method: console.error,\n  },\n};\n\nclass Logger {\n  constructor(scope, level) {\n    this.level = +level || LogLevel.ERROR.value;\n    this.scope = scope || '';\n  }\n\n  setLogLevel(levelStr) {\n    if (levelStr && typeof levelStr === 'string') {\n      const lvlStr = levelStr.toUpperCase();\n      this.level = LogLevel[lvlStr] ? LogLevel[lvlStr].value : this.level;\n    }\n  }\n\n  setScope(scopeVal) {\n    this.scope = scopeVal || this.scope;\n  }\n\n  log(...args) {\n    this.logBase(args, LogLevel.LOG.value);\n  }\n\n  info(...args) {\n    this.logBase(args, LogLevel.INFO.value);\n  }\n\n  debug(...args) {\n    this.logBase(args, LogLevel.DEBUG.value);\n  }\n\n  warn(...args) {\n    this.logBase(args, LogLevel.WARN.value);\n  }\n\n  error(...args) {\n    this.logBase(args, LogLevel.ERROR.value);\n  }\n\n  logBase(args, logLevel) {\n    if (this.level <= logLevel) {\n      const logVal = Object.values(LogLevel).find((val) => val.value === logLevel);\n      logVal.method(...this.getLogData(args));\n    }\n  }\n\n  /**\n   * Formats the console message using `scope`\n   * @param {*} logArgs\n   * @returns updated log arguments\n   */\n  getLogData(logArgs) {\n    if (Array.isArray(logArgs) && logArgs.length > 0) {\n      // prefix SDK identifier\n      let msg = `%c RS SDK`;\n\n      // format the log message using `scope`\n      if (this.scope) {\n        msg = `${msg} - ${this.scope}`;\n      }\n\n      // trim whitespaces\n      const orgMsg = logArgs[0].trim();\n\n      // prepare the final message\n      msg = `${msg} %c ${orgMsg}`;\n\n      const retArgs = [];\n      retArgs.push(msg);\n\n      // add style for the prefix\n      retArgs.push('font-weight: bold; background: black; color: white;');\n\n      // reset the style for the actual message\n      retArgs.push('font-weight: normal;');\n\n      // append rest of the original arguments\n      retArgs.push(...logArgs.slice(1));\n      return retArgs;\n    }\n    return logArgs;\n  }\n}\n\nexport default Logger;\n","const NAME = 'LEMNISK';\nconst CNameMapping = {\n  [NAME]: NAME,\n  'LEMNISK_MARKETING_AUTOMATION': NAME,\n  'Lemnisk Marketing Automation': NAME,\n  'LemniskMarketingAutomation': NAME,\n  'lemniskmarketingautomation': NAME,\n  'lemniskMarketingAutomation': NAME,\n  'lemnisk': NAME,\n  'Lemnisk': NAME,\n};\n\nexport { NAME, CNameMapping };","/* eslint-disable no-var */\n/* eslint-disable no-param-reassign */\n/* eslint-disable func-names */\n/* eslint-disable class-methods-use-this */\nimport Logger from \"../../utils/logger\";\nimport { LOAD_ORIGIN } from '../../utils/ScriptLoader';\nimport { NAME } from './constants';\n\nconst logger = new Logger(NAME);\nclass Lemnisk{\n    constructor(config, analytics, destinationInfo) {\n        if (analytics.logLevel) {\n            logger.setLogLevel(analytics.logLevel);\n        }\n        this.accountId = config.accountId;\n        this.sdkWriteKey = config.sdkWriteKey;\n        this.name = NAME;\n        this.areTransformationsConnected = destinationInfo && destinationInfo.areTransformationsConnected;\n        this.destinationId = destinationInfo && destinationInfo.destinationId;\n    }\n\n    init() {\n        logger.debug('===in init Lemnisk Marketing Automation===');\n        (function (window, tag, o, a, r) {\n            \n            var methods = [\n                \"init\",\n                \"page\",\n                \"track\",\n                \"identify\"\n            ];\n            window.lmSMTObj = window.lmSMTObj || [];\n            \n            for (var i = 0; i < methods.length; i++) {\n                lmSMTObj[methods[i]] = function (methodName) {\n                    return function () {\n                        lmSMTObj.push([methodName].concat(Array.prototype.slice.call(arguments)));\n                    };\n                }(methods[i]);\n            }\n            // eslint-disable-next-line no-param-reassign\n            a = o.getElementsByTagName('head')[0];\n            // eslint-disable-next-line no-param-reassign\n            r = o.createElement('script');\n            r.setAttribute('data-loader', LOAD_ORIGIN);\n            r.type = \"text/javascript\";\n            r.async = 1;\n            r.src = tag;\n            a.appendChild(r);\n        })(\n            window,\n            document.location.protocol === 'https:' ? `https://cdn25.lemnisk.co/ssp/st/${  this.accountId  }.js` : `http://cdn25.lemnisk.co/ssp/st/${  this.accountId  }.js`,\n            document\n        );\n        window.lmSMTObj.init(this.sdkWriteKey);\n    }\n\n    isLoaded() {\n        logger.debug(\"===In isLoaded Lemnisk Marketing Automation===\");\n        return !!window.lmSMTObj;\n    }\n\n    isReady() {\n        logger.debug('===In isReady Lemnisk Marketing Automation===');\n        return !!window.lmSMTObj;\n    }\n\n    identify(rudderElement) {\n        logger.debug('===In Lemnisk Marketing Automation identify===');\n        const userId = rudderElement.message.userId || rudderElement.message.anonymousId;\n        if (!userId) {\n            logger.debug('[Lemnisk] identify:: user id is required');\n            return;\n        }\n        // disabling eslint as message will be there iinn any case\n        // eslint-disable-next-line no-unsafe-optional-chaining \n        const { traits } = rudderElement.message?.context;\n        if(traits){\n        window.lmSMTObj.identify(rudderElement.message.userId, traits);\n        }\n        else\n        {\n        window.lmSMTObj.identify(rudderElement.message.userId);\n        }\n    }\n\n    track(rudderElement) {\n        logger.debug('===In Lemnisk Marketing Automation track===');\n        const { event, properties } = rudderElement.message;\n\n        if (!event) {\n            logger.error('[Lemnisk] track:: Event name is missing!');\n            return;\n        }\n        if (properties) {\n            window.lmSMTObj.track(event, properties);\n        } else {\n            window.lmSMTObj.track(event);\n        }\n    }\n\n    page(rudderElement) {\n        logger.debug('===In Lemnisk Marketing Automation page===');\n        const { name, properties } = rudderElement.message;\n        if (name && !properties) {\n            window.lmSMTObj.page(name);\n        } else if (!name && properties) {\n            window.lmSMTObj.page(properties);\n        } else if (name && properties) {\n            window.lmSMTObj.page(name, properties);\n        } else {\n            window.lmSMTObj.page();\n        }\n    }\n}\nexport default Lemnisk;","/* eslint-disable no-use-before-define */\n// import logger from \"../utils/logUtil\";\n\nimport { handleError } from \"./errorHandler\";\n\nconst defaultAsyncState = true;\n\nexport const LOAD_ORIGIN = 'RS_JS_SDK';\n/**\n * Script loader\n * @param {String} id                               Id of the script\n * @param {String} src                              URL of the script\n * @param {Object} options                          Object containing different configuration\n * @param {Boolean} options.async                   Determines script will be loaded asynchronously or not\n * @param {Boolean} options.isNonNativeSDK          Determines whether the script that will be loaded is one of RS's own\n * @param {Boolean} options.skipDatasetAttributes   Determines whether to add or skip dataset attribute\n */\nconst ScriptLoader = (id, src, options = {}) => {\n  try {\n    const exists = document.getElementById(id);\n    if (exists) {\n      // logger.debug(\"script already loaded\");\n      return;\n    }\n\n    const js = document.createElement('script');\n    js.src = src;\n    js.async = options.async === undefined ? defaultAsyncState : options.async;\n    js.type = 'text/javascript';\n    js.id = id;\n    // This checking is in place to skip the dataset attribute for some cases(while loading polyfill)\n    if (options.skipDatasetAttributes !== true) {\n      js.setAttribute('data-loader', LOAD_ORIGIN);\n      if (options.isNonNativeSDK !== undefined) {\n        js.setAttribute('data-isNonNativeSDK', options.isNonNativeSDK);\n      }\n    }\n    const headElmColl = document.getElementsByTagName('head');\n    if (headElmColl.length > 0) {\n      // logger.debug(\"==adding script==\", js);\n      headElmColl[0].insertBefore(js, headElmColl[0].firstChild);\n    } else {\n      const e = document.getElementsByTagName('script')[0];\n      // logger.debug(\"==parent script==\", e);\n      // logger.debug(\"==adding script==\", js);\n      e.parentNode.insertBefore(js, e);\n    }\n  } catch (e) {\n    handleError(e);\n  }\n};\n\nexport default ScriptLoader;\n"],"names":["_CNameMapping","LogLevel","LOG","value","method","console","log","INFO","info","DEBUG","debug","WARN","warn","ERROR","error","Logger","scope","level","_classCallCheck","this","_createClass","key","levelStr","lvlStr","toUpperCase","scopeVal","_len","arguments","length","args","Array","_key","logBase","_len2","_key2","_len3","_key3","_len4","_key4","_len5","_key5","logLevel","logVal","Object","values","find","val","apply","_toConsumableArray","getLogData","logArgs","isArray","msg","concat","orgMsg","trim","retArgs","push","slice","NAME","_defineProperty","logger","Lemnisk","config","analytics","destinationInfo","setLogLevel","accountId","sdkWriteKey","name","areTransformationsConnected","destinationId","window","tag","o","a","r","methods","lmSMTObj","i","methodName","prototype","call","getElementsByTagName","createElement","setAttribute","type","async","src","appendChild","document","location","protocol","init","rudderElement","_rudderElement$messag2","message","userId","anonymousId","traits","context","identify","_rudderElement$messag3","event","properties","track","_rudderElement$messag4","page"],"mappings":"mmDAAA,ICAAA,EDAMC,EAAW,CACfC,IAAK,CACHC,MAAO,EACPC,OAAQC,QAAQC,KAElBC,KAAM,CACJJ,MAAO,EACPC,OAAQC,QAAQG,MAElBC,MAAO,CACLN,MAAO,EACPC,OAAQC,QAAQK,OAElBC,KAAM,CACJR,MAAO,EACPC,OAAQC,QAAQO,MAElBC,MAAO,CACLV,MAAO,EACPC,OAAQC,QAAQS,QAIdC,EAAM,WACV,SAAAA,EAAYC,EAAOC,GAAOC,EAAAH,KAAAA,GACxBI,KAAKF,OAASA,GAAShB,EAASY,MAAMV,MACtCgB,KAAKH,MAAQA,GAAS,EACxB,CA2ECD,OA3EAK,EAAAL,EAAAM,CAAAA,CAAAA,IAAAlB,cAAAA,MAED,SAAYmB,GACV,GAAIA,GAAgC,iBAAbA,EAAuB,CAC5C,IAAMC,EAASD,EAASE,cACxBL,KAAKF,MAAQhB,EAASsB,GAAUtB,EAASsB,GAAQpB,MAAQgB,KAAKF,KAChE,CACF,GAACI,CAAAA,IAAAlB,WAAAA,MAED,SAASsB,GACPN,KAAKH,MAAQS,GAAYN,KAAKH,KAChC,GAAC,CAAAK,IAAA,MAAAlB,MAED,WAAa,IAAA,IAAAuB,EAAAC,UAAAC,OAANC,EAAI,IAAAC,MAAAJ,GAAAK,EAAA,EAAAA,EAAAL,EAAAK,IAAJF,EAAIE,GAAAJ,UAAAI,GACTZ,KAAKa,QAAQH,EAAM5B,EAASC,IAAIC,MAClC,GAACkB,CAAAA,IAAAlB,OAAAA,MAED,WAAc8B,IAAAA,IAAAA,EAAAN,UAAAC,OAANC,EAAI,IAAAC,MAAAG,GAAAC,EAAA,EAAAA,EAAAD,EAAAC,IAAJL,EAAIK,GAAAP,UAAAO,GACVf,KAAKa,QAAQH,EAAM5B,EAASM,KAAKJ,MACnC,GAACkB,CAAAA,IAAAlB,QAAAA,MAED,WAAegC,IAAAA,IAAAA,EAAAR,UAAAC,OAANC,EAAIC,IAAAA,MAAAK,GAAAC,EAAAA,EAAAA,EAAAD,EAAAC,IAAJP,EAAIO,GAAAT,UAAAS,GACXjB,KAAKa,QAAQH,EAAM5B,EAASQ,MAAMN,MACpC,GAAC,CAAAkB,IAAA,OAAAlB,MAED,WAAc,IAAA,IAAAkC,EAAAV,UAAAC,OAANC,EAAI,IAAAC,MAAAO,GAAAC,EAAA,EAAAA,EAAAD,EAAAC,IAAJT,EAAIS,GAAAX,UAAAW,GACVnB,KAAKa,QAAQH,EAAM5B,EAASU,KAAKR,MACnC,GAACkB,CAAAA,IAAAlB,QAAAA,MAED,WAAeoC,IAAAA,IAAAA,EAAAZ,UAAAC,OAANC,EAAIC,IAAAA,MAAAS,GAAAC,EAAAA,EAAAA,EAAAD,EAAAC,IAAJX,EAAIW,GAAAb,UAAAa,GACXrB,KAAKa,QAAQH,EAAM5B,EAASY,MAAMV,MACpC,GAAC,CAAAkB,IAAA,UAAAlB,MAED,SAAQ0B,EAAMY,GACZ,GAAItB,KAAKF,OAASwB,EAAU,CAC1B,IAAMC,EAASC,OAAOC,OAAO3C,GAAU4C,MAAK,SAACC,GAAQ,OAAAA,EAAI3C,QAAUsC,CAAQ,IAC3EC,EAAOtC,OAAM2C,MAAbL,EAAMM,EAAW7B,KAAK8B,WAAWpB,IACnC,CACF,GAEA,CAAAR,IAAA,aAAAlB,MAKA,SAAW+C,GACT,GAAIpB,MAAMqB,QAAQD,IAAYA,EAAQtB,OAAS,EAAG,CAEhD,IAAIwB,EAAG,YAGHjC,KAAKH,QACPoC,KAAGC,OAAMD,EAAG,OAAAC,OAAMlC,KAAKH,QAIzB,IAAMsC,EAASJ,EAAQ,GAAGK,OAG1BH,EAAG,GAAAC,OAAMD,UAAGC,OAAOC,GAEnB,IAAME,EAAU,GAWhB,OAVAA,EAAQC,KAAKL,GAGbI,EAAQC,KAAK,uDAGbD,EAAQC,KAAK,wBAGbD,EAAQC,KAAIV,MAAZS,EAAOR,EAASE,EAAQQ,MAAM,KACvBF,CACT,CACA,OAAON,CACT,KAACnC,CAGH,CAlFY,GCvBN4C,EAAO,UACKC,EAAA5D,KACf2D,EAAOA,GAAIC,EAAA5D,EACZ,+BAAgC2D,GAAIC,EAAA5D,EACpC,+BAAgC2D,GAAIC,EAAA5D,EACpC,6BAA8B2D,GAAIC,EAAA5D,EAClC,6BAA8B2D,GAAIC,EAAA5D,EAClC,6BAA8B2D,GAAIC,EAAA5D,EAClC,UAAW2D,GAAIC,EAAA5D,EACf,UAAW2D,GCDb,IAAME,EAAS,IAAI9C,EAAO4C,GACpBG,aACF,SAAAA,EAAYC,EAAQC,EAAWC,GAAiB/C,EAAAC,KAAA2C,GACxCE,EAAUvB,UACVoB,EAAOK,YAAYF,EAAUvB,UAEjCtB,KAAKgD,UAAYJ,EAAOI,UACxBhD,KAAKiD,YAAcL,EAAOK,YAC1BjD,KAAKkD,KAAOV,EACZxC,KAAKmD,4BAA8BL,GAAmBA,EAAgBK,4BACtEnD,KAAKoD,cAAgBN,GAAmBA,EAAgBM,aAC5D,CA8FC,OA9FAnD,EAAA0C,EAAAzC,CAAAA,CAAAA,IAAAlB,OAAAA,MAED,WACI0D,EAAOnD,MAAM,8CACb,SAAW8D,EAAQC,EAAKC,EAAGC,EAAGC,GAE1B,IAAIC,EAAU,CACV,OACA,OACA,QACA,YAEJL,EAAOM,SAAWN,EAAOM,UAAY,GAErC,IAAK,IAAIC,EAAI,EAAGA,EAAIF,EAAQjD,OAAQmD,IAChCD,SAASD,EAAQE,IAAM,SAAUC,GAC7B,OAAmB,WACfF,SAASrB,KAAK,CAACuB,GAAY3B,OAAOvB,MAAMmD,UAAUvB,MAAMwB,KAAKvD,YACjE,CACJ,CAJuB,CAIrBkD,EAAQE,IAGdJ,EAAID,EAAES,qBAAqB,QAAQ,IAEnCP,EAAIF,EAAEU,cAAc,WAClBC,aAAa,cCrCA,aDsCfT,EAAEU,KAAO,kBACTV,EAAEW,MAAQ,EACVX,EAAEY,IAAMf,EACRE,EAAEc,YAAYb,EACjB,CA1BD,CA2BIJ,OAC+B,WAA/BkB,SAASC,SAASC,SAAqB,mCAAAvC,OAAwClC,KAAKgD,UAAS,OAAA,kCAAAd,OAA8ClC,KAAKgD,UAAS,OACzJuB,UAEJlB,OAAOM,SAASe,KAAK1E,KAAKiD,YAC9B,GAAC,CAAA/C,IAAAlB,WAAAA,MAED,WAEI,OADA0D,EAAOnD,MAAM,oDACJ8D,OAAOM,QACpB,GAACzD,CAAAA,cAAAlB,MAED,WAEI,OADA0D,EAAOnD,MAAM,mDACJ8D,OAAOM,QACpB,GAAC,CAAAzD,IAAAlB,WAAAA,MAED,SAAS2F,OAAeC,EAGpB,GAFAlC,EAAOnD,MAAM,kDACEoF,EAAcE,QAAQC,QAAUH,EAAcE,QAAQE,YACrE,CAMA,IAAQC,GAAgCJ,QAAxCA,EAAmBD,EAAcE,eAAdD,IAAqBA,OAArBA,EAAAA,EAAuBK,SAAlCD,OACLA,EACH3B,OAAOM,SAASuB,SAASP,EAAcE,QAAQC,OAAQE,GAIvD3B,OAAOM,SAASuB,SAASP,EAAcE,QAAQC,OAT/C,MAFIpC,EAAOnD,MAAM,2CAarB,GAACW,CAAAA,YAAAlB,MAED,SAAM2F,GACFjC,EAAOnD,MAAM,+CACb,IAAA4F,EAA8BR,EAAcE,QAApCO,EAAKD,EAALC,MAAOC,EAAUF,EAAVE,WAEVD,EAIDC,EACAhC,OAAOM,SAAS2B,MAAMF,EAAOC,GAE7BhC,OAAOM,SAAS2B,MAAMF,GANtB1C,EAAO/C,MAAM,2CAQrB,IAACO,IAAA,OAAAlB,MAED,SAAK2F,GACDjC,EAAOnD,MAAM,8CACb,IAAAgG,EAA6BZ,EAAcE,QAAnC3B,EAAIqC,EAAJrC,KAAMmC,EAAUE,EAAVF,WACVnC,IAASmC,EACThC,OAAOM,SAAS6B,KAAKtC,IACbA,GAAQmC,EAChBhC,OAAOM,SAAS6B,KAAKH,GACdnC,GAAQmC,EACfhC,OAAOM,SAAS6B,KAAKtC,EAAMmC,GAE3BhC,OAAOM,SAAS6B,MAExB,KAAC7C,CAAA"}