{"version":3,"file":"Lytics.min.js","sources":["../../../src/utils/logUtil.js","../../../src/integrations/Lytics/constants.js","../../../src/integrations/Lytics/browser.js","../../../src/utils/ScriptLoader.js"],"sourcesContent":["const LOG_LEVEL_INFO = 1;\nconst LOG_LEVEL_DEBUG = 2;\nconst LOG_LEVEL_WARN = 3;\nconst LOG_LEVEL_ERROR = 4;\nconst DEF_LOG_LEVEL = LOG_LEVEL_ERROR;\nlet LOG_LEVEL = DEF_LOG_LEVEL;\n\nconst logger = {\n  setLogLevel(logLevel) {\n    switch (logLevel.toUpperCase()) {\n      case 'INFO':\n        LOG_LEVEL = LOG_LEVEL_INFO;\n        break;\n      case 'DEBUG':\n        LOG_LEVEL = LOG_LEVEL_DEBUG;\n        break;\n      case 'WARN':\n        LOG_LEVEL = LOG_LEVEL_WARN;\n        break;\n      default:\n        LOG_LEVEL = DEF_LOG_LEVEL;\n        break;\n    }\n  },\n\n  info(...args) {\n    if (LOG_LEVEL <= LOG_LEVEL_INFO) {\n      console.info(...args);\n    }\n  },\n\n  debug(...args) {\n    if (LOG_LEVEL <= LOG_LEVEL_DEBUG) {\n      console.log(...args);\n    }\n  },\n\n  warn(...args) {\n    if (LOG_LEVEL <= LOG_LEVEL_WARN) {\n      console.warn(...args);\n    }\n  },\n\n  error(...args) {\n    if (LOG_LEVEL <= LOG_LEVEL_ERROR) {\n      console.error(...args);\n    }\n  },\n};\n\nexport default logger;\n","const NAME = 'LYTICS';\nconst CNameMapping = {\n  [NAME]: NAME,\n  Lytics: NAME,\n  lytics: NAME,\n};\n\nexport { NAME, CNameMapping };\n","/* eslint-disable no-param-reassign */\n/* eslint-disable class-methods-use-this */\n// disabled these for Lytics js tag\n/* eslint-disable no-plusplus */\n/* eslint-disable block-scoped-var */\n/* eslint-disable no-sequences */\n/* eslint-disable yoda */\n/* eslint-disable prefer-spread */\n// disabling these eslint which are caused by the Lytics js tag\n\n/* eslint-disable prefer-rest-params */\n/* eslint-disable no-var */\n/* eslint-disable vars-on-top */\n/* eslint-disable no-return-assign */\n/* eslint-disable no-shadow */\n/* eslint-disable no-void */\n/* eslint-disable no-unused-expressions */\n/* eslint-disable one-var */\n/* eslint-disable lines-around-directive */\n/* eslint-disable strict */\nimport logger from '../../utils/logUtil';\nimport { LOAD_ORIGIN } from '../../utils/ScriptLoader';\nimport { NAME } from './constants';\n\nclass Lytics {\n  constructor(config, analytics, destinationInfo) {\n    if (analytics.logLevel) {\n      logger.setLogLevel(analytics.logLevel);\n    }\n    this.accountId = config.accountId;\n    this.stream = config.stream;\n    this.blockload = config.blockload;\n    this.loadid = config.loadid;\n    this.name = NAME;\n    this.forFirstName = ['firstname', 'firstName'];\n    this.forLastName = ['lastname', 'lastName'];\n    this.areTransformationsConnected = destinationInfo && destinationInfo.areTransformationsConnected;\n    this.destinationId = destinationInfo && destinationInfo.destinationId;\n  }\n\n  loadLyticsScript() {\n    (function () {\n      'use strict';\n      var o = window.jstag || (window.jstag = {}),\n        r = [];\n      function n(e) {\n        o[e] = function () {\n          for (var n = arguments.length, t = new Array(n), i = 0; i < n; i++) t[i] = arguments[i];\n          r.push([e, t]);\n        };\n      }\n      n('send'),\n        n('mock'),\n        n('identify'),\n        n('pageView'),\n        n('unblock'),\n        n('getid'),\n        n('setid'),\n        n('loadEntity'),\n        n('getEntity'),\n        n('on'),\n        n('once'),\n        n('call'),\n        (o.loadScript = function (n, t, i) {\n          var e = document.createElement('script');\n          (e.async = !0),\n            (e.src = n),\n            (e.onload = t),\n            (e.onerror = i),\n            e.setAttribute('data-loader', LOAD_ORIGIN);\n          var o = document.getElementsByTagName('script')[0],\n            r = (o && o.parentNode) || document.head || document.body,\n            c = o || r.lastChild;\n          return null != c ? r.insertBefore(e, c) : r.appendChild(e), this;\n        }),\n        (o.init = function n(t) {\n          return (\n            (this.config = t),\n            this.loadScript(t.src, function () {\n              if (o.init === n) throw new Error('Load error!');\n              // eslint-disable-next-line no-unused-expressions\n              o.init(o.config),\n                // eslint-disable-next-line func-names\n                (function () {\n                  for (var n = 0; n < r.length; n++) {\n                    var t = r[n][0],\n                      i = r[n][1];\n                    o[t].apply(o, i);\n                  }\n                  r = void 0;\n                })();\n            }),\n            this\n          );\n        });\n    })();\n\n    // Define config and initialize Lytics tracking tag.\n    window.jstag.init({\n      loadid: this.loadid,\n      blocked: this.blockload,\n      stream: this.stream,\n      sessecs: 1800,\n      src:\n        document.location.protocol === 'https:'\n          ? `https://c.lytics.io/api/tag/${this.accountId}/latest.min.js`\n          : `http://c.lytics.io/api/tag/${this.accountId}/latest.min.js`,\n      pageAnalysis: {\n        dataLayerPull: {\n          disabled: true,\n        },\n      },\n    });\n  }\n\n  init() {\n    this.loadLyticsScript();\n    logger.debug('===in init Lytics===');\n  }\n\n  isLoaded() {\n    logger.debug('in Lytics isLoaded');\n    logger.debug(!!(window.jstag && window.jstag.push !== Array.prototype.push));\n    return !!(window.jstag && window.jstag.push !== Array.prototype.push);\n  }\n\n  isReady() {\n    logger.debug('in Lytics isReady');\n    return !!(window.jstag && window.jstag.push !== Array.prototype.push);\n  }\n\n  identify(rudderElement) {\n    logger.debug('in Lytics identify');\n    // eslint-disable-next-line camelcase\n    const user_id = rudderElement.message.userId || rudderElement.message.anonymousId;\n    const { traits } = rudderElement.message.context;\n    const payload = { user_id, ...traits };\n    this.handleName(payload);\n    window.jstag.send(this.stream, payload);\n  }\n\n  page(rudderElement) {\n    logger.debug('in Lytics page');\n    const { properties } = rudderElement.message;\n    const payload = { event: rudderElement.message.name, ...properties };\n    this.handleName(payload);\n    window.jstag.pageView(this.stream, payload);\n  }\n\n  track(rudderElement) {\n    logger.debug('in Lytics track');\n    const { properties } = rudderElement.message;\n    const payload = { _e: rudderElement.message.event, ...properties };\n    this.handleName(payload);\n    window.jstag.send(this.stream, payload);\n  }\n\n  handleName(payload) {\n    this.forFirstName.forEach((key) => {\n      if (payload[key]) {\n        payload.first_name = payload[key];\n        delete payload[key];\n      }\n    });\n    this.forLastName.forEach((key) => {\n      if (payload[key]) {\n        payload.last_name = payload[key];\n        delete payload[key];\n      }\n    });\n    return payload;\n  }\n}\nexport default Lytics;\n","/* eslint-disable no-use-before-define */\n// import logger from \"../utils/logUtil\";\n\nimport { handleError } from \"./errorHandler\";\n\nconst defaultAsyncState = true;\n\nexport const LOAD_ORIGIN = 'RS_JS_SDK';\n/**\n * Script loader\n * @param {String} id                               Id of the script\n * @param {String} src                              URL of the script\n * @param {Object} options                          Object containing different configuration\n * @param {Boolean} options.async                   Determines script will be loaded asynchronously or not\n * @param {Boolean} options.isNonNativeSDK          Determines whether the script that will be loaded is one of RS's own\n * @param {Boolean} options.skipDatasetAttributes   Determines whether to add or skip dataset attribute\n */\nconst ScriptLoader = (id, src, options = {}) => {\n  try {\n    const exists = document.getElementById(id);\n    if (exists) {\n      // logger.debug(\"script already loaded\");\n      return;\n    }\n\n    const js = document.createElement('script');\n    js.src = src;\n    js.async = options.async === undefined ? defaultAsyncState : options.async;\n    js.type = 'text/javascript';\n    js.id = id;\n    // This checking is in place to skip the dataset attribute for some cases(while loading polyfill)\n    if (options.skipDatasetAttributes !== true) {\n      js.setAttribute('data-loader', LOAD_ORIGIN);\n      if (options.isNonNativeSDK !== undefined) {\n        js.setAttribute('data-isNonNativeSDK', options.isNonNativeSDK);\n      }\n    }\n    const headElmColl = document.getElementsByTagName('head');\n    if (headElmColl.length > 0) {\n      // logger.debug(\"==adding script==\", js);\n      headElmColl[0].insertBefore(js, headElmColl[0].firstChild);\n    } else {\n      const e = document.getElementsByTagName('script')[0];\n      // logger.debug(\"==parent script==\", e);\n      // logger.debug(\"==adding script==\", js);\n      e.parentNode.insertBefore(js, e);\n    }\n  } catch (e) {\n    handleError(e);\n  }\n};\n\nexport default ScriptLoader;\n"],"names":["_CNameMapping","LOG_LEVEL","logger","logLevel","toUpperCase","_console2","console","log","apply","arguments","NAME","_defineProperty","Lytics","config","analytics","destinationInfo","_classCallCheck","this","accountId","stream","blockload","loadid","name","forFirstName","forLastName","areTransformationsConnected","destinationId","key","value","o","window","jstag","r","n","e","length","t","Array","i","push","loadScript","document","createElement","async","src","onload","onerror","setAttribute","getElementsByTagName","parentNode","head","body","c","lastChild","insertBefore","appendChild","init","Error","blocked","sessecs","location","protocol","concat","pageAnalysis","dataLayerPull","disabled","loadLyticsScript","prototype","rudderElement","payload","_objectSpread","user_id","message","userId","anonymousId","context","traits","handleName","send","properties","event","pageView","_e","forEach","first_name","last_name"],"mappings":"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"}