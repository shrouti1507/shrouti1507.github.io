{"version":3,"file":"Pendo.min.js","sources":["../../../src/utils/logUtil.js","../../../src/integrations/Pendo/constants.js","../../../src/integrations/Pendo/browser.js","../../../src/utils/ScriptLoader.js"],"sourcesContent":["const LOG_LEVEL_INFO = 1;\nconst LOG_LEVEL_DEBUG = 2;\nconst LOG_LEVEL_WARN = 3;\nconst LOG_LEVEL_ERROR = 4;\nconst DEF_LOG_LEVEL = LOG_LEVEL_ERROR;\nlet LOG_LEVEL = DEF_LOG_LEVEL;\n\nconst logger = {\n  setLogLevel(logLevel) {\n    switch (logLevel.toUpperCase()) {\n      case 'INFO':\n        LOG_LEVEL = LOG_LEVEL_INFO;\n        break;\n      case 'DEBUG':\n        LOG_LEVEL = LOG_LEVEL_DEBUG;\n        break;\n      case 'WARN':\n        LOG_LEVEL = LOG_LEVEL_WARN;\n        break;\n      default:\n        LOG_LEVEL = DEF_LOG_LEVEL;\n        break;\n    }\n  },\n\n  info(...args) {\n    if (LOG_LEVEL <= LOG_LEVEL_INFO) {\n      console.info(...args);\n    }\n  },\n\n  debug(...args) {\n    if (LOG_LEVEL <= LOG_LEVEL_DEBUG) {\n      console.log(...args);\n    }\n  },\n\n  warn(...args) {\n    if (LOG_LEVEL <= LOG_LEVEL_WARN) {\n      console.warn(...args);\n    }\n  },\n\n  error(...args) {\n    if (LOG_LEVEL <= LOG_LEVEL_ERROR) {\n      console.error(...args);\n    }\n  },\n};\n\nexport default logger;\n","const NAME = 'PENDO';\nconst CNameMapping = {\n  [NAME]: NAME,\n  Pendo: NAME,\n  pendo: NAME,\n};\n\nexport { NAME, CNameMapping };\n","/* eslint-disable class-methods-use-this */\n/* eslint-disable lines-between-class-members */\nimport logger from '../../utils/logUtil';\nimport { LOAD_ORIGIN } from '../../utils/ScriptLoader';\nimport { NAME } from './constants';\n\nclass Pendo {\n  constructor(config, analytics, destinationInfo) {\n    if (analytics.logLevel) {\n      logger.setLogLevel(analytics.logLevel);\n    }\n    this.analytics = analytics;\n    this.apiKey = !config.apiKey ? '' : config.apiKey;\n    this.name = NAME;\n    this.areTransformationsConnected = destinationInfo && destinationInfo.areTransformationsConnected;\n    this.destinationId = destinationInfo && destinationInfo.destinationId;\n    logger.debug('Config ', config);\n  }\n\n  init() {\n    (function (apiKey) {\n      (function (p, e, n, d, o) {\n        let v;\n        let w;\n        let x;\n        let y;\n        let z;\n        o = p[d] = p[d] || {};\n        o._q = [];\n        v = ['initialize', 'identify', 'updateOptions', 'pageLoad', 'track'];\n        for (w = 0, x = v.length; w < x; ++w)\n          (function (m) {\n            o[m] =\n              o[m] ||\n              function () {\n                o._q[m === v[0] ? 'unshift' : 'push']([m].concat([].slice.call(arguments, 0)));\n              };\n          })(v[w]);\n        y = e.createElement(n);\n        y.setAttribute('data-loader', LOAD_ORIGIN);\n        y.async = !0;\n        y.src = `https://cdn.pendo.io/agent/static/${apiKey}/pendo.js`;\n        z = e.getElementsByTagName(n)[0];\n        z.parentNode.insertBefore(y, z);\n      })(window, document, 'script', 'pendo');\n    })(this.apiKey);\n    this.initializeMe();\n    logger.debug('===in init Pendo===');\n  }\n\n  initializeMe() {\n    const userId =\n      this.analytics.userId || this.constructPendoAnonymousId(this.analytics.anonymousId);\n\n    const accountObj = {\n      id: this.analytics.groupId,\n      ...this.analytics.groupTraits,\n    };\n    const visitorObj = { id: userId, ...this.analytics.userTraits };\n\n    window.pendo.initialize({ account: accountObj, visitor: visitorObj });\n  }\n\n  /* utility functions ---Start here ---  */\n  isLoaded() {\n    return !!(window.pendo && window.pendo.push !== Array.prototype.push);\n  }\n\n  isReady() {\n    return !!(window.pendo && window.pendo.push !== Array.prototype.push);\n  }\n\n  constructPendoAnonymousId(id) {\n    return `_PENDO_T_${id}`;\n  }\n  /* utility functions --- Ends here ---  */\n\n  /*\n   * PENDO MAPPED FUNCTIONS :: identify, track, group\n   */\n\n  /* Pendo's identify call works intelligently, once u have identified a visitor/user,\n   *or associated a visitor to a group/account then Pendo save this data in local storage and\n   *any further upcoming calls are done taking user info from local.\n   * To track user perndo maps user to Visitor in Pendo.\n   */\n  identify(rudderElement) {\n    let visitorObj = {};\n    let accountObj = {};\n    const { groupId } = this.analytics;\n    const id = this.analytics.userId || this.constructPendoAnonymousId(this.analytics.anonymousId);\n    visitorObj = {\n      id,\n      ...this.analytics.userTraits,\n    };\n\n    if (groupId) {\n      accountObj = { id: groupId, ...this.analytics.groupTraits };\n    }\n\n    window.pendo.identify({ visitor: visitorObj, account: accountObj });\n  }\n  /*\n   *Group call maps to an account for which visitor belongs.\n   *It is same as identify call but here we send account object.\n   */\n  group(rudderElement) {\n    let accountObj = {};\n    let visitorObj = {};\n    const { userId, traits } = rudderElement.message;\n    accountObj.id = this.analytics.groupId || this.analytics.anonymousId;\n    accountObj = {\n      ...accountObj,\n      ...traits,\n    };\n\n    if (userId) {\n      visitorObj = {\n        id: userId,\n        ...(rudderElement.message.context && rudderElement.message.context.traits),\n      };\n    }\n\n    window.pendo.identify({ account: accountObj, visitor: visitorObj });\n  }\n\n  /* Once user is identified Pendo makes Track call to track user activity.\n   */\n  track(rudderElement) {\n    const { event } = rudderElement.message;\n    if (!event) {\n      throw Error('Cannot call un-named track event');\n    }\n    const props = rudderElement.message.properties;\n    window.pendo.track(event, props);\n  }\n}\n\nexport { Pendo };\n","/* eslint-disable no-use-before-define */\n// import logger from \"../utils/logUtil\";\n\nimport { handleError } from \"./errorHandler\";\n\nconst defaultAsyncState = true;\n\nexport const LOAD_ORIGIN = 'RS_JS_SDK';\n/**\n * Script loader\n * @param {String} id                               Id of the script\n * @param {String} src                              URL of the script\n * @param {Object} options                          Object containing different configuration\n * @param {Boolean} options.async                   Determines script will be loaded asynchronously or not\n * @param {Boolean} options.isNonNativeSDK          Determines whether the script that will be loaded is one of RS's own\n * @param {Boolean} options.skipDatasetAttributes   Determines whether to add or skip dataset attribute\n */\nconst ScriptLoader = (id, src, options = {}) => {\n  try {\n    const exists = document.getElementById(id);\n    if (exists) {\n      // logger.debug(\"script already loaded\");\n      return;\n    }\n\n    const js = document.createElement('script');\n    js.src = src;\n    js.async = options.async === undefined ? defaultAsyncState : options.async;\n    js.type = 'text/javascript';\n    js.id = id;\n    // This checking is in place to skip the dataset attribute for some cases(while loading polyfill)\n    if (options.skipDatasetAttributes !== true) {\n      js.setAttribute('data-loader', LOAD_ORIGIN);\n      if (options.isNonNativeSDK !== undefined) {\n        js.setAttribute('data-isNonNativeSDK', options.isNonNativeSDK);\n      }\n    }\n    const headElmColl = document.getElementsByTagName('head');\n    if (headElmColl.length > 0) {\n      // logger.debug(\"==adding script==\", js);\n      headElmColl[0].insertBefore(js, headElmColl[0].firstChild);\n    } else {\n      const e = document.getElementsByTagName('script')[0];\n      // logger.debug(\"==parent script==\", e);\n      // logger.debug(\"==adding script==\", js);\n      e.parentNode.insertBefore(js, e);\n    }\n  } catch (e) {\n    handleError(e);\n  }\n};\n\nexport default ScriptLoader;\n"],"names":["_CNameMapping","LOG_LEVEL","logger","logLevel","toUpperCase","_console2","console","log","apply","arguments","NAME","_defineProperty","Pendo","config","analytics","destinationInfo","_classCallCheck","this","apiKey","name","areTransformationsConnected","destinationId","key","value","p","e","n","d","o","v","w","x","y","z","_q","length","m","concat","slice","call","createElement","setAttribute","async","src","getElementsByTagName","parentNode","insertBefore","window","document","initializeMe","userId","constructPendoAnonymousId","anonymousId","accountObj","_objectSpread","id","groupId","groupTraits","visitorObj","userTraits","pendo","initialize","account","visitor","push","Array","prototype","rudderElement","identify","_rudderElement$messag","message","traits","context","event","Error","props","properties","track"],"mappings":"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"}