{"version":3,"file":"BingAds.min.js","sources":["../../../src/utils/logUtil.js","../../../src/integrations/BingAds/constants.js","../../../src/integrations/BingAds/browser.js","../../../src/utils/ScriptLoader.js"],"sourcesContent":["const LOG_LEVEL_INFO = 1;\nconst LOG_LEVEL_DEBUG = 2;\nconst LOG_LEVEL_WARN = 3;\nconst LOG_LEVEL_ERROR = 4;\nconst DEF_LOG_LEVEL = LOG_LEVEL_ERROR;\nlet LOG_LEVEL = DEF_LOG_LEVEL;\n\nconst logger = {\n  setLogLevel(logLevel) {\n    switch (logLevel.toUpperCase()) {\n      case 'INFO':\n        LOG_LEVEL = LOG_LEVEL_INFO;\n        break;\n      case 'DEBUG':\n        LOG_LEVEL = LOG_LEVEL_DEBUG;\n        break;\n      case 'WARN':\n        LOG_LEVEL = LOG_LEVEL_WARN;\n        break;\n      default:\n        LOG_LEVEL = DEF_LOG_LEVEL;\n        break;\n    }\n  },\n\n  info(...args) {\n    if (LOG_LEVEL <= LOG_LEVEL_INFO) {\n      console.info(...args);\n    }\n  },\n\n  debug(...args) {\n    if (LOG_LEVEL <= LOG_LEVEL_DEBUG) {\n      console.log(...args);\n    }\n  },\n\n  warn(...args) {\n    if (LOG_LEVEL <= LOG_LEVEL_WARN) {\n      console.warn(...args);\n    }\n  },\n\n  error(...args) {\n    if (LOG_LEVEL <= LOG_LEVEL_ERROR) {\n      console.error(...args);\n    }\n  },\n};\n\nexport default logger;\n","const NAME = 'BINGADS';\nconst CNameMapping = {\n  [NAME]: NAME,\n  BingAds: NAME,\n  bingads: NAME,\n  'Bing Ads': NAME,\n  'Bing ads': NAME,\n  'bing Ads': NAME,\n  'bing ads': NAME,\n};\n\nexport { NAME, CNameMapping };\n","import logger from '../../utils/logUtil';\nimport { LOAD_ORIGIN } from '../../utils/ScriptLoader';\nimport { NAME } from './constants';\n\nclass BingAds {\n  constructor(config, analytics, destinationInfo) {\n    if (analytics.logLevel) {\n      logger.setLogLevel(analytics.logLevel);\n    }\n    this.tagID = config.tagID;\n    this.name = NAME;\n    this.areTransformationsConnected = destinationInfo && destinationInfo.areTransformationsConnected;\n    this.destinationId = destinationInfo && destinationInfo.destinationId;\n    this.uniqueId = `bing${this.tagID}`;\n  }\n\n  /* eslint-disable */\n  loadBingadsScript = () => {\n    ((w, d, t, r, u) => {\n      let f;\n      let n;\n      let i;\n      (w[u] = w[u] || []),\n        (f = () => {\n          const o = {\n            ti: this.tagID,\n          };\n          (o.q = w[u]), ((w[u] = new UET(o)));\n        }),\n        (n = d.createElement(t)),\n        (n.src = r),\n        (n.async = 1),\n        n.setAttribute('data-loader', LOAD_ORIGIN),\n        (n.onload = n.onreadystatechange =\n          function () {\n            const s = this.readyState;\n            (s && s !== 'loaded' && s !== 'complete' && typeof w['UET'] === \"function\") ||\n              (f(), (n.onload = n.onreadystatechange = null));\n          }),\n        (i = d.getElementsByTagName(t)[0]),\n        i.parentNode.insertBefore(n, i);\n    })(window, document, 'script', 'https://bat.bing.com/bat.js', this.uniqueId);\n  };\n  /* eslint-enable */\n\n  init = () => {\n    this.loadBingadsScript();  \n    logger.debug('===in init BingAds===');\n  };\n\n  isLoaded = () => {\n    logger.debug('in BingAds isLoaded');\n    // if(typeof window.UET !== 'function') {\n    //   logger.debug('BingAds: UET class is yet to be loaded. Retrying.');\n    // } else {\n    //   window[this.uniqueId] = new window.UET(this.tagID);\n    //   logger.debug('BingAds: UET class is successfully loaded');\n    // }\n    return (!!window.UET && !!window[this.uniqueId] && window[this.uniqueId].push !== Array.prototype.push);\n  };\n\n  isReady = () => {\n    logger.debug('in BingAds isReady');\n    return !!(window[this.uniqueId] && window[this.uniqueId].push !== Array.prototype.push);\n  };\n\n  /*\n    Visit here(for details Parameter details): https://help.ads.microsoft.com/#apex/3/en/53056/2\n    Under: What data does UET collect once I install it on my website?\n    Updated syntax doc ref - https://help.ads.microsoft.com/#apex/ads/en/56916/2\n  */\n\n  track = (rudderElement) => {\n    const { type, properties, event } = rudderElement.message;\n    const { category, currency, value, revenue, total } = properties;\n    const eventToSend = type;\n    if (!eventToSend) {\n      logger.error('Event type not present');\n      return;\n    }\n    const payload = {\n      event_label: event,\n    };\n    if (category) {\n      payload.event_category = category;\n    }\n    if (currency) {\n      payload.currency = currency;\n    }\n    if (value) {\n      payload.revenue_value = value;\n    }\n    if (revenue) {\n      payload.revenue_value = revenue;\n    }\n    if (total) {\n      payload.revenue_value = total;\n    }\n    window[this.uniqueId].push('event', eventToSend, payload);\n  };\n\n  page = () => {\n    window[this.uniqueId].push('pageLoad');\n  };\n}\n\nexport { BingAds };\n","/* eslint-disable no-use-before-define */\n// import logger from \"../utils/logUtil\";\n\nimport { handleError } from \"./errorHandler\";\n\nconst defaultAsyncState = true;\n\nexport const LOAD_ORIGIN = 'RS_JS_SDK';\n/**\n * Script loader\n * @param {String} id                               Id of the script\n * @param {String} src                              URL of the script\n * @param {Object} options                          Object containing different configuration\n * @param {Boolean} options.async                   Determines script will be loaded asynchronously or not\n * @param {Boolean} options.isNonNativeSDK          Determines whether the script that will be loaded is one of RS's own\n * @param {Boolean} options.skipDatasetAttributes   Determines whether to add or skip dataset attribute\n */\nconst ScriptLoader = (id, src, options = {}) => {\n  try {\n    const exists = document.getElementById(id);\n    if (exists) {\n      // logger.debug(\"script already loaded\");\n      return;\n    }\n\n    const js = document.createElement('script');\n    js.src = src;\n    js.async = options.async === undefined ? defaultAsyncState : options.async;\n    js.type = 'text/javascript';\n    js.id = id;\n    // This checking is in place to skip the dataset attribute for some cases(while loading polyfill)\n    if (options.skipDatasetAttributes !== true) {\n      js.setAttribute('data-loader', LOAD_ORIGIN);\n      if (options.isNonNativeSDK !== undefined) {\n        js.setAttribute('data-isNonNativeSDK', options.isNonNativeSDK);\n      }\n    }\n    const headElmColl = document.getElementsByTagName('head');\n    if (headElmColl.length > 0) {\n      // logger.debug(\"==adding script==\", js);\n      headElmColl[0].insertBefore(js, headElmColl[0].firstChild);\n    } else {\n      const e = document.getElementsByTagName('script')[0];\n      // logger.debug(\"==parent script==\", e);\n      // logger.debug(\"==adding script==\", js);\n      e.parentNode.insertBefore(js, e);\n    }\n  } catch (e) {\n    handleError(e);\n  }\n};\n\nexport default ScriptLoader;\n"],"names":["_CNameMapping","LOG_LEVEL","logger","logLevel","toUpperCase","_console2","console","log","apply","arguments","_console4","error","NAME","_defineProperty","BingAds","_createClass","config","analytics","destinationInfo","_this","this","_classCallCheck","loadBingadsScript","w","d","t","u","f","n","i","window","document","uniqueId","o","ti","tagID","q","UET","createElement","src","async","setAttribute","onload","onreadystatechange","s","readyState","getElementsByTagName","parentNode","insertBefore","init","isLoaded","push","Array","prototype","isReady","track","rudderElement","message","type","_rudderElement$messag","properties","event","category","currency","value","revenue","total","eventToSend","event_label","payload","event_category","revenue_value","page","name","areTransformationsConnected","destinationId","concat"],"mappings":"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"}