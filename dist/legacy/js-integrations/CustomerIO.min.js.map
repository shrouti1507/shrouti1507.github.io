{"version":3,"file":"CustomerIO.min.js","sources":["../../../src/utils/logUtil.js","../../../src/integrations/CustomerIO/constants.js","../../../src/integrations/CustomerIO/browser.js","../../../src/utils/ScriptLoader.js"],"sourcesContent":["const LOG_LEVEL_INFO = 1;\nconst LOG_LEVEL_DEBUG = 2;\nconst LOG_LEVEL_WARN = 3;\nconst LOG_LEVEL_ERROR = 4;\nconst DEF_LOG_LEVEL = LOG_LEVEL_ERROR;\nlet LOG_LEVEL = DEF_LOG_LEVEL;\n\nconst logger = {\n  setLogLevel(logLevel) {\n    switch (logLevel.toUpperCase()) {\n      case 'INFO':\n        LOG_LEVEL = LOG_LEVEL_INFO;\n        break;\n      case 'DEBUG':\n        LOG_LEVEL = LOG_LEVEL_DEBUG;\n        break;\n      case 'WARN':\n        LOG_LEVEL = LOG_LEVEL_WARN;\n        break;\n      default:\n        LOG_LEVEL = DEF_LOG_LEVEL;\n        break;\n    }\n  },\n\n  info(...args) {\n    if (LOG_LEVEL <= LOG_LEVEL_INFO) {\n      console.info(...args);\n    }\n  },\n\n  debug(...args) {\n    if (LOG_LEVEL <= LOG_LEVEL_DEBUG) {\n      console.log(...args);\n    }\n  },\n\n  warn(...args) {\n    if (LOG_LEVEL <= LOG_LEVEL_WARN) {\n      console.warn(...args);\n    }\n  },\n\n  error(...args) {\n    if (LOG_LEVEL <= LOG_LEVEL_ERROR) {\n      console.error(...args);\n    }\n  },\n};\n\nexport default logger;\n","const NAME = 'CUSTOMERIO';\nconst CNameMapping = {\n  [NAME]: NAME,\n  Customerio: NAME,\n  'Customer.io': NAME,\n  'CUSTOMER.IO': NAME,\n  'customer.io': NAME,\n};\n\nexport { NAME, CNameMapping };\n","/* eslint-disable class-methods-use-this */\nimport logger from '../../utils/logUtil';\nimport { LOAD_ORIGIN } from '../../utils/ScriptLoader';\nimport { NAME } from './constants';\n\nclass CustomerIO {\n  constructor(config, analytics, destinationInfo) {\n    if (analytics.logLevel) {\n      logger.setLogLevel(analytics.logLevel);\n    }\n    this.siteID = config.siteID;\n    this.apiKey = config.apiKey;\n    this.name = NAME;\n    this.areTransformationsConnected = destinationInfo && destinationInfo.areTransformationsConnected;\n    this.destinationId = destinationInfo && destinationInfo.destinationId;\n  }\n\n  init() {\n    logger.debug('===in init Customer IO init===');\n    window._cio = window._cio || [];\n    const { siteID } = this;\n    (function () {\n      let a;\n      let b;\n      let c;\n      a = function (f) {\n        return function () {\n          window._cio.push([f].concat(Array.prototype.slice.call(arguments, 0)));\n        };\n      };\n      b = ['load', 'identify', 'sidentify', 'track', 'page'];\n      for (c = 0; c < b.length; c++) {\n        window._cio[b[c]] = a(b[c]);\n      }\n      const t = document.createElement('script');\n      const s = document.getElementsByTagName('script')[0];\n      t.async = true;\n      t.setAttribute('data-loader', LOAD_ORIGIN);\n      t.id = 'cio-tracker';\n      t.setAttribute('data-site-id', siteID);\n      t.src = 'https://assets.customer.io/assets/track.js';\n      s.parentNode.insertBefore(t, s);\n    })();\n  }\n\n  identify(rudderElement) {\n    logger.debug('in Customer IO identify');\n    const userId = rudderElement.message.userId\n      ? rudderElement.message.userId\n      : rudderElement.message.anonymousId;\n    const traits = rudderElement.message.context.traits ? rudderElement.message.context.traits : {};\n    const createAt = traits.createdAt;\n    if (createAt) {\n      traits.created_at = Math.floor(new Date(createAt).getTime() / 1000);\n    }\n    traits.id = userId;\n    window._cio.identify(traits);\n  }\n\n  track(rudderElement) {\n    logger.debug('in Customer IO track');\n\n    const eventName = rudderElement.message.event;\n    const { properties } = rudderElement.message;\n    window._cio.track(eventName, properties);\n  }\n\n  page(rudderElement) {\n    logger.debug('in Customer IO page');\n\n    const name = rudderElement.message.name || rudderElement.message.properties.url;\n    window._cio.page(name, rudderElement.message.properties);\n  }\n\n  isLoaded() {\n    return !!(window._cio && window._cio.push !== Array.prototype.push);\n  }\n\n  isReady() {\n    return !!(window._cio && window._cio.push !== Array.prototype.push);\n  }\n}\n\nexport { CustomerIO };\n","/* eslint-disable no-use-before-define */\n// import logger from \"../utils/logUtil\";\n\nimport { handleError } from \"./errorHandler\";\n\nconst defaultAsyncState = true;\n\nexport const LOAD_ORIGIN = 'RS_JS_SDK';\n/**\n * Script loader\n * @param {String} id                               Id of the script\n * @param {String} src                              URL of the script\n * @param {Object} options                          Object containing different configuration\n * @param {Boolean} options.async                   Determines script will be loaded asynchronously or not\n * @param {Boolean} options.isNonNativeSDK          Determines whether the script that will be loaded is one of RS's own\n * @param {Boolean} options.skipDatasetAttributes   Determines whether to add or skip dataset attribute\n */\nconst ScriptLoader = (id, src, options = {}) => {\n  try {\n    const exists = document.getElementById(id);\n    if (exists) {\n      // logger.debug(\"script already loaded\");\n      return;\n    }\n\n    const js = document.createElement('script');\n    js.src = src;\n    js.async = options.async === undefined ? defaultAsyncState : options.async;\n    js.type = 'text/javascript';\n    js.id = id;\n    // This checking is in place to skip the dataset attribute for some cases(while loading polyfill)\n    if (options.skipDatasetAttributes !== true) {\n      js.setAttribute('data-loader', LOAD_ORIGIN);\n      if (options.isNonNativeSDK !== undefined) {\n        js.setAttribute('data-isNonNativeSDK', options.isNonNativeSDK);\n      }\n    }\n    const headElmColl = document.getElementsByTagName('head');\n    if (headElmColl.length > 0) {\n      // logger.debug(\"==adding script==\", js);\n      headElmColl[0].insertBefore(js, headElmColl[0].firstChild);\n    } else {\n      const e = document.getElementsByTagName('script')[0];\n      // logger.debug(\"==parent script==\", e);\n      // logger.debug(\"==adding script==\", js);\n      e.parentNode.insertBefore(js, e);\n    }\n  } catch (e) {\n    handleError(e);\n  }\n};\n\nexport default ScriptLoader;\n"],"names":["LOG_LEVEL","logger","logLevel","toUpperCase","_console2","console","log","apply","arguments","NAME","_defineProperty","_CNameMapping","CustomerIO","config","analytics","destinationInfo","_classCallCheck","this","siteID","apiKey","name","areTransformationsConnected","destinationId","key","value","window","_cio","a","b","c","f","push","concat","Array","prototype","slice","call","length","t","document","createElement","s","getElementsByTagName","async","setAttribute","id","src","parentNode","insertBefore","rudderElement","userId","message","anonymousId","traits","context","createAt","createdAt","created_at","Math","floor","Date","getTime","identify","eventName","event","properties","track","url","page"],"mappings":"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"}