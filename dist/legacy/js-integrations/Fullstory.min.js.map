{"version":3,"file":"Fullstory.min.js","sources":["../../../src/utils/camelcase.js","../../../src/utils/ScriptLoader.js","../../../src/integrations/Fullstory/constants.js","../../../src/integrations/Fullstory/browser.js"],"sourcesContent":["// util function to convert the input to string type\nfunction convertToString(input) {\n  if (input) {\n    if (typeof input === 'string') {\n      return input;\n    }\n\n    return String(input);\n  }\n  return '';\n}\n\n// convert string to words\nfunction toWords(input) {\n  const regex =\n    /[A-Z\\xC0-\\xD6\\xD8-\\xDE]?[a-z\\xDF-\\xF6\\xF8-\\xFF]+|[A-Z\\xC0-\\xD6\\xD8-\\xDE]+(?![a-z\\xDF-\\xF6\\xF8-\\xFF])|\\d+/g;\n\n  return convertToString(input).match(regex);\n}\n\n// convert the input array to camel case\nfunction toCamelCase(inputArray) {\n  let result = '';\n  if (!inputArray) return result;\n\n  for (let i = 0, len = inputArray.length; i < len; i += 1) {\n    const currentStr = inputArray[i];\n\n    let tempStr = currentStr.toLowerCase();\n\n    if (i !== 0) {\n      // convert first letter to upper case (the word is in lowercase)\n      tempStr = tempStr.substr(0, 1).toUpperCase() + tempStr.substr(1);\n    }\n    result += tempStr;\n  }\n  return result;\n}\n\n// this function call all other functions\n\nfunction camelcase(input) {\n  const words = toWords(input);\n\n  return toCamelCase(words);\n}\n\nexport default camelcase;\n","/* eslint-disable no-use-before-define */\n// import logger from \"../utils/logUtil\";\n\nimport { handleError } from \"./errorHandler\";\n\nconst defaultAsyncState = true;\n\nexport const LOAD_ORIGIN = 'RS_JS_SDK';\n/**\n * Script loader\n * @param {String} id                               Id of the script\n * @param {String} src                              URL of the script\n * @param {Object} options                          Object containing different configuration\n * @param {Boolean} options.async                   Determines script will be loaded asynchronously or not\n * @param {Boolean} options.isNonNativeSDK          Determines whether the script that will be loaded is one of RS's own\n * @param {Boolean} options.skipDatasetAttributes   Determines whether to add or skip dataset attribute\n */\nconst ScriptLoader = (id, src, options = {}) => {\n  try {\n    const exists = document.getElementById(id);\n    if (exists) {\n      // logger.debug(\"script already loaded\");\n      return;\n    }\n\n    const js = document.createElement('script');\n    js.src = src;\n    js.async = options.async === undefined ? defaultAsyncState : options.async;\n    js.type = 'text/javascript';\n    js.id = id;\n    // This checking is in place to skip the dataset attribute for some cases(while loading polyfill)\n    if (options.skipDatasetAttributes !== true) {\n      js.setAttribute('data-loader', LOAD_ORIGIN);\n      if (options.isNonNativeSDK !== undefined) {\n        js.setAttribute('data-isNonNativeSDK', options.isNonNativeSDK);\n      }\n    }\n    const headElmColl = document.getElementsByTagName('head');\n    if (headElmColl.length > 0) {\n      // logger.debug(\"==adding script==\", js);\n      headElmColl[0].insertBefore(js, headElmColl[0].firstChild);\n    } else {\n      const e = document.getElementsByTagName('script')[0];\n      // logger.debug(\"==parent script==\", e);\n      // logger.debug(\"==adding script==\", js);\n      e.parentNode.insertBefore(js, e);\n    }\n  } catch (e) {\n    handleError(e);\n  }\n};\n\nexport default ScriptLoader;\n","const NAME = 'FULLSTORY';\nconst CNameMapping = {\n  [NAME]: NAME,\n  Fullstory: NAME,\n  FullStory: NAME,\n  'full Story': NAME,\n  'Full Story': NAME,\n  'Full story': NAME,\n  'full story': NAME,\n  fullstory: NAME,\n};\n\nexport { NAME, CNameMapping };\n","/* eslint-disable class-methods-use-this */\n/* eslint-disable no-undef */\nimport camelcase from '../../utils/camelcase';\nimport logger from '../../utils/logUtil';\nimport { LOAD_ORIGIN } from '../../utils/ScriptLoader';\nimport { NAME } from './constants';\n\nclass Fullstory {\n  constructor(config, analytics, destinationInfo) {\n    this.fs_org = config.fs_org;\n    this.fs_debug_mode = config.fs_debug_mode;\n    this.name = NAME;\n    this.analytics = analytics;\n    this.areTransformationsConnected = destinationInfo && destinationInfo.areTransformationsConnected;\n    this.destinationId = destinationInfo && destinationInfo.destinationId;\n  }\n\n  static getFSProperties(properties) {\n    const FS_properties = {};\n    Object.keys(properties).map(function (key, index) {\n      FS_properties[\n        key === 'displayName' || key === 'email' ? key : Fullstory.camelCaseField(key)\n      ] = properties[key];\n    });\n    return FS_properties;\n  }\n\n  static camelCaseField(fieldName) {\n    // Do not camel case across type suffixes.\n    const parts = fieldName.split('_');\n    if (parts.length > 1) {\n      const typeSuffix = parts.pop();\n      switch (typeSuffix) {\n        case 'str':\n        case 'int':\n        case 'date':\n        case 'real':\n        case 'bool':\n        case 'strs':\n        case 'ints':\n        case 'dates':\n        case 'reals':\n        case 'bools':\n          return `${camelcase(parts.join('_'))}_${typeSuffix}`;\n        default: // passthrough\n      }\n    }\n    // No type suffix found. Camel case the whole field name.\n    return camelcase(fieldName);\n  }\n\n  init() {\n    logger.debug('===in init FULLSTORY===');\n    window._fs_debug = this.fs_debug_mode;\n    window._fs_host = 'fullstory.com';\n    window._fs_script = 'edge.fullstory.com/s/fs.js';\n    window._fs_org = this.fs_org;\n    window._fs_namespace = 'FS';\n    (function (m, n, e, t, l, o, g, y) {\n      if (e in m) {\n        if (m.console && m.console.log) {\n          m.console.log('FullStory namespace conflict. Please set window[\"_fs_namespace\"].');\n        }\n        return;\n      }\n      g = m[e] = function (a, b, s) {\n        g.q ? g.q.push([a, b, s]) : g._api(a, b, s);\n      };\n      g.q = [];\n      o = n.createElement(t);\n      o.async = 1;\n      o.crossOrigin = 'anonymous';\n      o.src = `https://${_fs_script}`;\n      o.setAttribute('data-loader', LOAD_ORIGIN);\n      y = n.getElementsByTagName(t)[0];\n      y.parentNode.insertBefore(o, y);\n      g.identify = function (i, v, s) {\n        g(l, { uid: i }, s);\n        if (v) g(l, v, s);\n      };\n      g.setUserVars = function (v, s) {\n        g(l, v, s);\n      };\n      g.event = function (i, v, s) {\n        g('event', { n: i, p: v }, s);\n      };\n      g.shutdown = function () {\n        g('rec', !1);\n      };\n      g.restart = function () {\n        g('rec', !0);\n      };\n      g.log = function (a, b) {\n        g('log', [a, b]);\n      };\n      g.consent = function (a) {\n        g('consent', !arguments.length || a);\n      };\n      g.identifyAccount = function (i, v) {\n        o = 'account';\n        v = v || {};\n        v.acctId = i;\n        g(o, v);\n      };\n      g.clearUserCookie = function () {};\n      g._w = {};\n      y = 'XMLHttpRequest';\n      g._w[y] = m[y];\n      y = 'fetch';\n      g._w[y] = m[y];\n      if (m[y])\n        m[y] = function () {\n          return g._w[y].apply(this, arguments);\n        };\n    })(window, document, window._fs_namespace, 'script', 'user');\n\n    const { FULLSTORY } = this.analytics.loadOnlyIntegrations;\n    // Checking if crossDomainSupport is their or not.\n    if (FULLSTORY?.crossDomainSupport === true) {\n      // This function will check if the customer hash is available or not in localStorage\n      window._fs_identity = function () {\n        if (window.localStorage) {\n          const { tata_customer_hash } = window.localStorage;\n          if (tata_customer_hash) {\n            return {\n              uid: tata_customer_hash,\n              displayName: tata_customer_hash,\n            };\n          }\n        } else {\n          logger.debug('Unable to access locaStorage');\n        }\n\n        return null;\n      };\n\n      (function () {\n        function fs(api) {\n          if (!window._fs_namespace) {\n            console.error('FullStory unavailable, window[\"_fs_namespace\"] must be defined');\n            return undefined;\n          }\n          return api ? window[window._fs_namespace][api] : window[window._fs_namespace];\n        }\n        function waitUntil(predicateFn, callbackFn, timeout, timeoutFn) {\n          let totalTime = 0;\n          let delay = 64;\n          const resultFn = function () {\n            if (typeof predicateFn === 'function' && predicateFn()) {\n              callbackFn();\n              return;\n            }\n            delay = Math.min(delay * 2, 1024);\n            if (totalTime > timeout) {\n              if (timeoutFn) {\n                timeoutFn();\n              }\n            }\n            totalTime += delay;\n            setTimeout(resultFn, delay);\n          };\n          resultFn();\n        }\n        // Checking if timeout is provided or not.\n        const timeout = FULLSTORY.timeout || 2000;\n\n        function identify() {\n          if (typeof window._fs_identity === 'function') {\n            const userVars = window._fs_identity();\n            if (typeof userVars === 'object' && typeof userVars.uid === 'string') {\n              fs('setUserVars')(userVars);\n              fs('restart')();\n            } else {\n              fs('log')('error', 'FS.setUserVars requires an object that contains uid');\n            }\n          } else {\n            fs('log')('error', 'window[\"_fs_identity\"] function not found');\n          }\n        }\n        fs('shutdown')();\n        waitUntil(window._fs_identity, identify, timeout, fs('restart'));\n      })();\n    }\n  }\n\n  page(rudderElement) {\n    logger.debug('in FULLSORY page');\n    const rudderMessage = rudderElement.message;\n    const pageName = rudderMessage.name;\n    const props = {\n      name: pageName,\n      ...rudderMessage.properties,\n    };\n\n    window.FS.event('Viewed a Page', Fullstory.getFSProperties(props));\n  }\n\n  identify(rudderElement) {\n    logger.debug('in FULLSORY identify');\n    let { userId } = rudderElement.message;\n    const { traits } = rudderElement.message.context;\n    if (!userId) userId = rudderElement.message.anonymousId;\n\n    if (Object.keys(traits).length === 0 && traits.constructor === Object)\n      window.FS.identify(userId);\n    else window.FS.identify(userId, Fullstory.getFSProperties(traits));\n  }\n\n  track(rudderElement) {\n    logger.debug('in FULLSTORY track');\n    window.FS.event(\n      rudderElement.message.event,\n      Fullstory.getFSProperties(rudderElement.message.properties),\n    );\n  }\n\n  isLoaded() {\n    logger.debug('in FULLSTORY isLoaded');\n    return !!window.FS;\n  }\n}\n\nexport { Fullstory };\n"],"names":["toWords","input","String","convertToString","match","camelcase","inputArray","result","i","len","length","tempStr","toLowerCase","substr","toUpperCase","toCamelCase","_CNameMapping","NAME","_defineProperty","Fullstory","config","analytics","destinationInfo","_classCallCheck","this","fs_org","fs_debug_mode","name","areTransformationsConnected","destinationId","key","value","m","n","e","t","l","o","g","y","window","_fs_debug","_fs_host","_fs_script","_fs_org","_fs_namespace","document","console","log","a","b","s","q","push","_api","createElement","async","crossOrigin","src","setAttribute","getElementsByTagName","parentNode","insertBefore","identify","v","uid","setUserVars","event","p","shutdown","restart","consent","arguments","identifyAccount","acctId","clearUserCookie","_w","apply","FULLSTORY","loadOnlyIntegrations","crossDomainSupport","_fs_identity","localStorage","tata_customer_hash","displayName","fs","api","error","timeout","predicateFn","callbackFn","timeoutFn","totalTime","resultFn","delay","Math","min","setTimeout","waitUntil","userVars","_typeof","rudderElement","rudderMessage","message","props","_objectSpread","properties","FS","getFSProperties","userId","traits","context","anonymousId","Object","keys","constructor","FS_properties","map","index","camelCaseField","fieldName","parts","split","typeSuffix","pop","join"],"mappings":"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"}