{"version":3,"file":"ProfitWell.min.js","sources":["../../../node_modules/isobject/index.js","../../../node_modules/get-value/index.js","../../../src/utils/logUtil.js","../../../src/integrations/ProfitWell/constants.js","../../../src/integrations/ProfitWell/browser.js","../../../src/utils/ScriptLoader.js"],"sourcesContent":["/*!\n * isobject <https://github.com/jonschlinkert/isobject>\n *\n * Copyright (c) 2014-2017, Jon Schlinkert.\n * Released under the MIT License.\n */\n\n'use strict';\n\nmodule.exports = function isObject(val) {\n  return val != null && typeof val === 'object' && Array.isArray(val) === false;\n};\n","/*!\n * get-value <https://github.com/jonschlinkert/get-value>\n *\n * Copyright (c) 2014-2018, Jon Schlinkert.\n * Released under the MIT License.\n */\n\nconst isObject = require('isobject');\n\nmodule.exports = function(target, path, options) {\n  if (!isObject(options)) {\n    options = { default: options };\n  }\n\n  if (!isValidObject(target)) {\n    return typeof options.default !== 'undefined' ? options.default : target;\n  }\n\n  if (typeof path === 'number') {\n    path = String(path);\n  }\n\n  const isArray = Array.isArray(path);\n  const isString = typeof path === 'string';\n  const splitChar = options.separator || '.';\n  const joinChar = options.joinChar || (typeof splitChar === 'string' ? splitChar : '.');\n\n  if (!isString && !isArray) {\n    return target;\n  }\n\n  if (isString && path in target) {\n    return isValid(path, target, options) ? target[path] : options.default;\n  }\n\n  let segs = isArray ? path : split(path, splitChar, options);\n  let len = segs.length;\n  let idx = 0;\n\n  do {\n    let prop = segs[idx];\n    if (typeof prop === 'number') {\n      prop = String(prop);\n    }\n\n    while (prop && prop.slice(-1) === '\\\\') {\n      prop = join([prop.slice(0, -1), segs[++idx] || ''], joinChar, options);\n    }\n\n    if (prop in target) {\n      if (!isValid(prop, target, options)) {\n        return options.default;\n      }\n\n      target = target[prop];\n    } else {\n      let hasProp = false;\n      let n = idx + 1;\n\n      while (n < len) {\n        prop = join([prop, segs[n++]], joinChar, options);\n\n        if ((hasProp = prop in target)) {\n          if (!isValid(prop, target, options)) {\n            return options.default;\n          }\n\n          target = target[prop];\n          idx = n - 1;\n          break;\n        }\n      }\n\n      if (!hasProp) {\n        return options.default;\n      }\n    }\n  } while (++idx < len && isValidObject(target));\n\n  if (idx === len) {\n    return target;\n  }\n\n  return options.default;\n};\n\nfunction join(segs, joinChar, options) {\n  if (typeof options.join === 'function') {\n    return options.join(segs);\n  }\n  return segs[0] + joinChar + segs[1];\n}\n\nfunction split(path, splitChar, options) {\n  if (typeof options.split === 'function') {\n    return options.split(path);\n  }\n  return path.split(splitChar);\n}\n\nfunction isValid(key, target, options) {\n  if (typeof options.isValid === 'function') {\n    return options.isValid(key, target);\n  }\n  return true;\n}\n\nfunction isValidObject(val) {\n  return isObject(val) || Array.isArray(val) || typeof val === 'function';\n}\n","const LOG_LEVEL_INFO = 1;\nconst LOG_LEVEL_DEBUG = 2;\nconst LOG_LEVEL_WARN = 3;\nconst LOG_LEVEL_ERROR = 4;\nconst DEF_LOG_LEVEL = LOG_LEVEL_ERROR;\nlet LOG_LEVEL = DEF_LOG_LEVEL;\n\nconst logger = {\n  setLogLevel(logLevel) {\n    switch (logLevel.toUpperCase()) {\n      case 'INFO':\n        LOG_LEVEL = LOG_LEVEL_INFO;\n        break;\n      case 'DEBUG':\n        LOG_LEVEL = LOG_LEVEL_DEBUG;\n        break;\n      case 'WARN':\n        LOG_LEVEL = LOG_LEVEL_WARN;\n        break;\n      default:\n        LOG_LEVEL = DEF_LOG_LEVEL;\n        break;\n    }\n  },\n\n  info(...args) {\n    if (LOG_LEVEL <= LOG_LEVEL_INFO) {\n      console.info(...args);\n    }\n  },\n\n  debug(...args) {\n    if (LOG_LEVEL <= LOG_LEVEL_DEBUG) {\n      console.log(...args);\n    }\n  },\n\n  warn(...args) {\n    if (LOG_LEVEL <= LOG_LEVEL_WARN) {\n      console.warn(...args);\n    }\n  },\n\n  error(...args) {\n    if (LOG_LEVEL <= LOG_LEVEL_ERROR) {\n      console.error(...args);\n    }\n  },\n};\n\nexport default logger;\n","const NAME = 'PROFITWELL';\nconst CNameMapping = {\n  [NAME]: NAME,\n  ProfitWell: NAME,\n  profitwell: NAME,\n  Profitwell: NAME,\n  'Profit Well': NAME,\n  'profit well': NAME,\n  'Profit well': NAME,\n};\n\nexport { NAME, CNameMapping };\n","/* eslint-disable class-methods-use-this */\nimport get from 'get-value';\nimport logger from '../../utils/logUtil';\nimport { LOAD_ORIGIN } from '../../utils/ScriptLoader';\nimport { NAME } from './constants';\n\nclass ProfitWell {\n  constructor(config, analytics, destinationInfo) {\n    if (analytics.logLevel) {\n      logger.setLogLevel(analytics.logLevel);\n    }\n    this.publicApiKey = config.publicApiKey;\n    this.siteType = config.siteType;\n    this.name = NAME;\n    this.areTransformationsConnected = destinationInfo && destinationInfo.areTransformationsConnected;\n    this.destinationId = destinationInfo && destinationInfo.destinationId;\n  }\n\n  init() {\n    logger.debug('===In init ProfitWell===');\n\n    if (!this.publicApiKey) {\n      logger.debug('===[ProfitWell]: Public API Key not found===');\n      return;\n    }\n\n    window.publicApiKey = this.publicApiKey;\n\n    const scriptTag = document.createElement('script');\n    scriptTag.setAttribute('id', 'profitwell-js');\n    scriptTag.setAttribute('data-pw-auth', window.publicApiKey);\n    document.body.appendChild(scriptTag);\n\n    (function (i, s, o, g, r, a, m) {\n      i[o] =\n        i[o] ||\n        function () {\n          (i[o].q = i[o].q || []).push(arguments);\n        };\n      a = s.createElement(g);\n      m = s.getElementsByTagName(g)[0];\n      a.async = 1;\n      a.setAttribute('data-loader', LOAD_ORIGIN);\n      a.src = `${r}?auth=${window.publicApiKey}`;\n      m.parentNode.insertBefore(a, m);\n    })(window, document, 'profitwell', 'script', 'https://public.profitwell.com/js/profitwell.js');\n  }\n\n  isLoaded() {\n    logger.debug('===In isLoaded ProfitWell===');\n    return !!(window.profitwell && window.profitwell.length !== 0);\n  }\n\n  isReady() {\n    logger.debug('===In isReady ProfitWell===');\n    return !!(window.profitwell && window.profitwell.length !== 0);\n  }\n\n  identify(rudderElement) {\n    logger.debug('===In ProfitWell identify===');\n\n    if (this.siteType === 'marketing') {\n      window.profitwell('start', {});\n      return;\n    }\n\n    const { message } = rudderElement;\n    const email = get(message, 'context.traits.email');\n    if (email) {\n      window.profitwell('start', {\n        user_email: email,\n      });\n      return;\n    }\n\n    const userId = get(message, 'userId');\n    if (userId) {\n      window.profitwell('start', {\n        user_id: userId,\n      });\n      return;\n    }\n\n    logger.debug('===[ProfitWell]: email or userId is required for identify===');\n  }\n}\n\nexport default ProfitWell;\n","/* eslint-disable no-use-before-define */\n// import logger from \"../utils/logUtil\";\n\nimport { handleError } from \"./errorHandler\";\n\nconst defaultAsyncState = true;\n\nexport const LOAD_ORIGIN = 'RS_JS_SDK';\n/**\n * Script loader\n * @param {String} id                               Id of the script\n * @param {String} src                              URL of the script\n * @param {Object} options                          Object containing different configuration\n * @param {Boolean} options.async                   Determines script will be loaded asynchronously or not\n * @param {Boolean} options.isNonNativeSDK          Determines whether the script that will be loaded is one of RS's own\n * @param {Boolean} options.skipDatasetAttributes   Determines whether to add or skip dataset attribute\n */\nconst ScriptLoader = (id, src, options = {}) => {\n  try {\n    const exists = document.getElementById(id);\n    if (exists) {\n      // logger.debug(\"script already loaded\");\n      return;\n    }\n\n    const js = document.createElement('script');\n    js.src = src;\n    js.async = options.async === undefined ? defaultAsyncState : options.async;\n    js.type = 'text/javascript';\n    js.id = id;\n    // This checking is in place to skip the dataset attribute for some cases(while loading polyfill)\n    if (options.skipDatasetAttributes !== true) {\n      js.setAttribute('data-loader', LOAD_ORIGIN);\n      if (options.isNonNativeSDK !== undefined) {\n        js.setAttribute('data-isNonNativeSDK', options.isNonNativeSDK);\n      }\n    }\n    const headElmColl = document.getElementsByTagName('head');\n    if (headElmColl.length > 0) {\n      // logger.debug(\"==adding script==\", js);\n      headElmColl[0].insertBefore(js, headElmColl[0].firstChild);\n    } else {\n      const e = document.getElementsByTagName('script')[0];\n      // logger.debug(\"==parent script==\", e);\n      // logger.debug(\"==adding script==\", js);\n      e.parentNode.insertBefore(js, e);\n    }\n  } catch (e) {\n    handleError(e);\n  }\n};\n\nexport default ScriptLoader;\n"],"names":["val","_typeof","Array","isArray","getValue","target","path","options","isObject","default","isValidObject","String","isString","splitChar","separator","joinChar","isValid","segs","split","len","length","idx","prop","slice","join","hasProp","n","key","_CNameMapping","LOG_LEVEL","logger","logLevel","toUpperCase","_console2","console","log","apply","arguments","NAME","_defineProperty","ProfitWell","config","analytics","destinationInfo","_classCallCheck","this","publicApiKey","siteType","name","areTransformationsConnected","destinationId","value","window","i","s","o","g","a","m","document","createElement","scriptTag","setAttribute","body","appendChild","q","push","getElementsByTagName","async","src","r","parentNode","insertBefore","profitwell","rudderElement","message","email","get","user_email","userId","user_id"],"mappings":"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"}