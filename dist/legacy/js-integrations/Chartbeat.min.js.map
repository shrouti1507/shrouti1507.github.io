{"version":3,"file":"Chartbeat.min.js","sources":["../../../node_modules/to-function/index.js","../../../node_modules/component-each/node_modules/component-type/index.js","../../../node_modules/component-props/index.js","../../../node_modules/component-each/index.js","../../../node_modules/on-body/index.js","../../../src/utils/logUtil.js","../../../src/utils/constants.js","../../../src/integrations/Chartbeat/constants.js","../../../src/utils/ScriptLoader.js","../../../src/integrations/Chartbeat/browser.js"],"sourcesContent":["\n/**\n * Module Dependencies\n */\n\nvar expr;\ntry {\n  expr = require('props');\n} catch(e) {\n  expr = require('component-props');\n}\n\n/**\n * Expose `toFunction()`.\n */\n\nmodule.exports = toFunction;\n\n/**\n * Convert `obj` to a `Function`.\n *\n * @param {Mixed} obj\n * @return {Function}\n * @api private\n */\n\nfunction toFunction(obj) {\n  switch ({}.toString.call(obj)) {\n    case '[object Object]':\n      return objectToFunction(obj);\n    case '[object Function]':\n      return obj;\n    case '[object String]':\n      return stringToFunction(obj);\n    case '[object RegExp]':\n      return regexpToFunction(obj);\n    default:\n      return defaultToFunction(obj);\n  }\n}\n\n/**\n * Default to strict equality.\n *\n * @param {Mixed} val\n * @return {Function}\n * @api private\n */\n\nfunction defaultToFunction(val) {\n  return function(obj){\n    return val === obj;\n  };\n}\n\n/**\n * Convert `re` to a function.\n *\n * @param {RegExp} re\n * @return {Function}\n * @api private\n */\n\nfunction regexpToFunction(re) {\n  return function(obj){\n    return re.test(obj);\n  };\n}\n\n/**\n * Convert property `str` to a function.\n *\n * @param {String} str\n * @return {Function}\n * @api private\n */\n\nfunction stringToFunction(str) {\n  // immediate such as \"> 20\"\n  if (/^ *\\W+/.test(str)) return new Function('_', 'return _ ' + str);\n\n  // properties such as \"name.first\" or \"age > 18\" or \"age > 18 && age < 36\"\n  return new Function('_', 'return ' + get(str));\n}\n\n/**\n * Convert `object` to a function.\n *\n * @param {Object} object\n * @return {Function}\n * @api private\n */\n\nfunction objectToFunction(obj) {\n  var match = {};\n  for (var key in obj) {\n    match[key] = typeof obj[key] === 'string'\n      ? defaultToFunction(obj[key])\n      : toFunction(obj[key]);\n  }\n  return function(val){\n    if (typeof val !== 'object') return false;\n    for (var key in match) {\n      if (!(key in val)) return false;\n      if (!match[key](val[key])) return false;\n    }\n    return true;\n  };\n}\n\n/**\n * Built the getter function. Supports getter style functions\n *\n * @param {String} str\n * @return {String}\n * @api private\n */\n\nfunction get(str) {\n  var props = expr(str);\n  if (!props.length) return '_.' + str;\n\n  var val, i, prop;\n  for (i = 0; i < props.length; i++) {\n    prop = props[i];\n    val = '_.' + prop;\n    val = \"('function' == typeof \" + val + \" ? \" + val + \"() : \" + val + \")\";\n\n    // mimic negative lookbehind to avoid problems with nested properties\n    str = stripNested(prop, str, val);\n  }\n\n  return str;\n}\n\n/**\n * Mimic negative lookbehind to avoid problems with nested properties.\n *\n * See: http://blog.stevenlevithan.com/archives/mimic-lookbehind-javascript\n *\n * @param {String} prop\n * @param {String} str\n * @param {String} val\n * @return {String}\n * @api private\n */\n\nfunction stripNested (prop, str, val) {\n  return str.replace(new RegExp('(\\\\.)?' + prop, 'g'), function($0, $1) {\n    return $1 ? $0 : val;\n  });\n}\n","\n/**\n * toString ref.\n */\n\nvar toString = Object.prototype.toString;\n\n/**\n * Return the type of `val`.\n *\n * @param {Mixed} val\n * @return {String}\n * @api public\n */\n\nmodule.exports = function(val){\n  switch (toString.call(val)) {\n    case '[object Function]': return 'function';\n    case '[object Date]': return 'date';\n    case '[object RegExp]': return 'regexp';\n    case '[object Arguments]': return 'arguments';\n    case '[object Array]': return 'array';\n    case '[object String]': return 'string';\n  }\n\n  if (val === null) return 'null';\n  if (val === undefined) return 'undefined';\n  if (val && val.nodeType === 1) return 'element';\n  if (val === Object(val)) return 'object';\n\n  return typeof val;\n};\n","/**\n * Global Names\n */\n\nvar globals = /\\b(Array|Date|Object|Math|JSON)\\b/g;\n\n/**\n * Return immediate identifiers parsed from `str`.\n *\n * @param {String} str\n * @param {String|Function} map function or prefix\n * @return {Array}\n * @api public\n */\n\nmodule.exports = function(str, fn){\n  var p = unique(props(str));\n  if (fn && 'string' == typeof fn) fn = prefixed(fn);\n  if (fn) return map(str, p, fn);\n  return p;\n};\n\n/**\n * Return immediate identifiers in `str`.\n *\n * @param {String} str\n * @return {Array}\n * @api private\n */\n\nfunction props(str) {\n  return str\n    .replace(/\\.\\w+|\\w+ *\\(|\"[^\"]*\"|'[^']*'|\\/([^/]+)\\//g, '')\n    .replace(globals, '')\n    .match(/[a-zA-Z_]\\w*/g)\n    || [];\n}\n\n/**\n * Return `str` with `props` mapped with `fn`.\n *\n * @param {String} str\n * @param {Array} props\n * @param {Function} fn\n * @return {String}\n * @api private\n */\n\nfunction map(str, props, fn) {\n  var re = /\\.\\w+|\\w+ *\\(|\"[^\"]*\"|'[^']*'|\\/([^/]+)\\/|[a-zA-Z_]\\w*/g;\n  return str.replace(re, function(_){\n    if ('(' == _[_.length - 1]) return fn(_);\n    if (!~props.indexOf(_)) return _;\n    return fn(_);\n  });\n}\n\n/**\n * Return unique array.\n *\n * @param {Array} arr\n * @return {Array}\n * @api private\n */\n\nfunction unique(arr) {\n  var ret = [];\n\n  for (var i = 0; i < arr.length; i++) {\n    if (~ret.indexOf(arr[i])) continue;\n    ret.push(arr[i]);\n  }\n\n  return ret;\n}\n\n/**\n * Map with prefix `str`.\n */\n\nfunction prefixed(str) {\n  return function(_){\n    return str + _;\n  };\n}\n","\n/**\n * Module dependencies.\n */\n\ntry {\n  var type = require('type');\n} catch (err) {\n  var type = require('component-type');\n}\n\nvar toFunction = require('to-function');\n\n/**\n * HOP reference.\n */\n\nvar has = Object.prototype.hasOwnProperty;\n\n/**\n * Iterate the given `obj` and invoke `fn(val, i)`\n * in optional context `ctx`.\n *\n * @param {String|Array|Object} obj\n * @param {Function} fn\n * @param {Object} [ctx]\n * @api public\n */\n\nmodule.exports = function(obj, fn, ctx){\n  fn = toFunction(fn);\n  ctx = ctx || this;\n  switch (type(obj)) {\n    case 'array':\n      return array(obj, fn, ctx);\n    case 'object':\n      if ('number' == typeof obj.length) return array(obj, fn, ctx);\n      return object(obj, fn, ctx);\n    case 'string':\n      return string(obj, fn, ctx);\n  }\n};\n\n/**\n * Iterate string chars.\n *\n * @param {String} obj\n * @param {Function} fn\n * @param {Object} ctx\n * @api private\n */\n\nfunction string(obj, fn, ctx) {\n  for (var i = 0; i < obj.length; ++i) {\n    fn.call(ctx, obj.charAt(i), i);\n  }\n}\n\n/**\n * Iterate object keys.\n *\n * @param {Object} obj\n * @param {Function} fn\n * @param {Object} ctx\n * @api private\n */\n\nfunction object(obj, fn, ctx) {\n  for (var key in obj) {\n    if (has.call(obj, key)) {\n      fn.call(ctx, key, obj[key]);\n    }\n  }\n}\n\n/**\n * Iterate array-ish.\n *\n * @param {Array|Object} obj\n * @param {Function} fn\n * @param {Object} ctx\n * @api private\n */\n\nfunction array(obj, fn, ctx) {\n  for (var i = 0; i < obj.length; ++i) {\n    fn.call(ctx, obj[i], i);\n  }\n}\n","var each = require('each');\n\n\n/**\n * Cache whether `<body>` exists.\n */\n\nvar body = false;\n\n\n/**\n * Callbacks to call when the body exists.\n */\n\nvar callbacks = [];\n\n\n/**\n * Export a way to add handlers to be invoked once the body exists.\n *\n * @param {Function} callback  A function to call when the body exists.\n */\n\nmodule.exports = function onBody (callback) {\n  if (body) {\n    call(callback);\n  } else {\n    callbacks.push(callback);\n  }\n};\n\n\n/**\n * Set an interval to check for `document.body`.\n */\n\nvar interval = setInterval(function () {\n  if (!document.body) return;\n  body = true;\n  each(callbacks, call);\n  clearInterval(interval);\n}, 5);\n\n\n/**\n * Call a callback, passing it the body.\n *\n * @param {Function} callback  The callback to call.\n */\n\nfunction call (callback) {\n  callback(document.body);\n}","const LOG_LEVEL_INFO = 1;\nconst LOG_LEVEL_DEBUG = 2;\nconst LOG_LEVEL_WARN = 3;\nconst LOG_LEVEL_ERROR = 4;\nconst DEF_LOG_LEVEL = LOG_LEVEL_ERROR;\nlet LOG_LEVEL = DEF_LOG_LEVEL;\n\nconst logger = {\n  setLogLevel(logLevel) {\n    switch (logLevel.toUpperCase()) {\n      case 'INFO':\n        LOG_LEVEL = LOG_LEVEL_INFO;\n        break;\n      case 'DEBUG':\n        LOG_LEVEL = LOG_LEVEL_DEBUG;\n        break;\n      case 'WARN':\n        LOG_LEVEL = LOG_LEVEL_WARN;\n        break;\n      default:\n        LOG_LEVEL = DEF_LOG_LEVEL;\n        break;\n    }\n  },\n\n  info(...args) {\n    if (LOG_LEVEL <= LOG_LEVEL_INFO) {\n      console.info(...args);\n    }\n  },\n\n  debug(...args) {\n    if (LOG_LEVEL <= LOG_LEVEL_DEBUG) {\n      console.log(...args);\n    }\n  },\n\n  warn(...args) {\n    if (LOG_LEVEL <= LOG_LEVEL_WARN) {\n      console.warn(...args);\n    }\n  },\n\n  error(...args) {\n    if (LOG_LEVEL <= LOG_LEVEL_ERROR) {\n      console.error(...args);\n    }\n  },\n};\n\nexport default logger;\n","// Reserved Keywords for properties/traits\nconst RESERVED_KEYS = [\n  'anonymous_id',\n  'id',\n  'sent_at',\n  'received_at',\n  'timestamp',\n  'original_timestamp',\n  'event_text',\n  'event',\n];\n\nconst CONFIG_URL =\n  'https://api.rudderlabs.com/sourceConfig/?p=__MODULE_TYPE__&v=__PACKAGE_VERSION__';\nconst SDK_CDN_BASE_URL = 'https://cdn.rudderlabs.com';\nconst CDN_ARCH_VERSION_DIR = 'v1.1';\nconst CDN_INT_DIR = 'js-integrations';\nconst DEST_SDK_BASE_URL = `${SDK_CDN_BASE_URL}/${CDN_ARCH_VERSION_DIR}/${CDN_INT_DIR}`;\n\nconst MAX_WAIT_FOR_INTEGRATION_LOAD = 10000;\nconst INTEGRATION_LOAD_CHECK_INTERVAL = 1000;\nconst MAX_TIME_TO_BUFFER_CLOUD_MODE_EVENTS = 10000;\nconst INTG_SUFFIX = '_RS';\nconst POLYFILL_URL =\n  'https://polyfill.io/v3/polyfill.min.js?features=Array.prototype.find%2CArray.prototype.includes%2CPromise%2CString.prototype.endsWith%2CString.prototype.includes%2CString.prototype.startsWith%2CObject.entries%2CObject.values%2CElement.prototype.dataset%2CString.prototype.replaceAll';\n\nconst GENERIC_TRUE_VALUES = ['true', 'True', 'TRUE', 't', 'T', '1'];\nconst GENERIC_FALSE_VALUES = ['false', 'False', 'FALSE', 'f', 'F', '0'];\n\nconst SAMESITE_COOKIE_OPTS = ['Lax', 'None', 'Strict'];\n\nconst DEFAULT_SESSION_TIMEOUT = 30 * 60 * 1000; // 30 min in milliseconds\nconst MIN_SESSION_TIMEOUT = 10 * 1000; // 10 sec in milliseconds\nconst MIN_SESSION_ID_LENGTH = 10;\n\nconst ERROR_REPORTING_SERVICE_GLOBAL_KEY_NAME = 'errorReporting';\nconst LOAD_ORIGIN = 'RS_JS_SDK';\n\nconst DEFAULT_REGION = 'US';\nconst DEFAULT_DATAPLANE_URL = 'https://hosted.rudderlabs.com';\n\nconst RESIDENCY_SERVERS = [DEFAULT_REGION, 'EU'];\n\nconst SUPPORTED_CONSENT_MANAGERS = ['oneTrust'];\n\nconst SYSTEM_KEYWORDS = ['library', 'consentManagement'];\nconst UA_CH_LEVELS = ['none', 'default', 'full'];\n\nconst DEFAULT_INTEGRATIONS_CONFIG = { All: true };\n\nexport {\n  RESERVED_KEYS,\n  CONFIG_URL,\n  SDK_CDN_BASE_URL,\n  CDN_ARCH_VERSION_DIR,\n  CDN_INT_DIR,\n  DEST_SDK_BASE_URL,\n  MAX_WAIT_FOR_INTEGRATION_LOAD,\n  INTEGRATION_LOAD_CHECK_INTERVAL,\n  INTG_SUFFIX,\n  POLYFILL_URL,\n  GENERIC_TRUE_VALUES,\n  GENERIC_FALSE_VALUES,\n  SAMESITE_COOKIE_OPTS,\n  DEFAULT_SESSION_TIMEOUT,\n  MIN_SESSION_TIMEOUT,\n  MIN_SESSION_ID_LENGTH,\n  ERROR_REPORTING_SERVICE_GLOBAL_KEY_NAME,\n  LOAD_ORIGIN,\n  DEFAULT_REGION,\n  DEFAULT_DATAPLANE_URL,\n  RESIDENCY_SERVERS,\n  SUPPORTED_CONSENT_MANAGERS,\n  SYSTEM_KEYWORDS,\n  UA_CH_LEVELS,\n  DEFAULT_INTEGRATIONS_CONFIG,\n  MAX_TIME_TO_BUFFER_CLOUD_MODE_EVENTS,\n};\n","const NAME = 'CHARTBEAT';\nconst CNameMapping = {\n  [NAME]: NAME,\n  Chartbeat: NAME,\n  chartbeat: NAME,\n  'Chart Beat': NAME,\n  'chart beat': NAME,\n};\n\nexport { NAME, CNameMapping };\n","/* eslint-disable no-use-before-define */\n// import logger from \"../utils/logUtil\";\n\nimport { handleError } from \"./errorHandler\";\n\nconst defaultAsyncState = true;\n\nexport const LOAD_ORIGIN = 'RS_JS_SDK';\n/**\n * Script loader\n * @param {String} id                               Id of the script\n * @param {String} src                              URL of the script\n * @param {Object} options                          Object containing different configuration\n * @param {Boolean} options.async                   Determines script will be loaded asynchronously or not\n * @param {Boolean} options.isNonNativeSDK          Determines whether the script that will be loaded is one of RS's own\n * @param {Boolean} options.skipDatasetAttributes   Determines whether to add or skip dataset attribute\n */\nconst ScriptLoader = (id, src, options = {}) => {\n  try {\n    const exists = document.getElementById(id);\n    if (exists) {\n      // logger.debug(\"script already loaded\");\n      return;\n    }\n\n    const js = document.createElement('script');\n    js.src = src;\n    js.async = options.async === undefined ? defaultAsyncState : options.async;\n    js.type = 'text/javascript';\n    js.id = id;\n    // This checking is in place to skip the dataset attribute for some cases(while loading polyfill)\n    if (options.skipDatasetAttributes !== true) {\n      js.setAttribute('data-loader', LOAD_ORIGIN);\n      if (options.isNonNativeSDK !== undefined) {\n        js.setAttribute('data-isNonNativeSDK', options.isNonNativeSDK);\n      }\n    }\n    const headElmColl = document.getElementsByTagName('head');\n    if (headElmColl.length > 0) {\n      // logger.debug(\"==adding script==\", js);\n      headElmColl[0].insertBefore(js, headElmColl[0].firstChild);\n    } else {\n      const e = document.getElementsByTagName('script')[0];\n      // logger.debug(\"==parent script==\", e);\n      // logger.debug(\"==adding script==\", js);\n      e.parentNode.insertBefore(js, e);\n    }\n  } catch (e) {\n    handleError(e);\n  }\n};\n\nexport default ScriptLoader;\n","/* eslint-disable class-methods-use-this */\nimport onBody from 'on-body';\nimport logger from '../../utils/logUtil';\nimport {\n  MAX_WAIT_FOR_INTEGRATION_LOAD,\n  INTEGRATION_LOAD_CHECK_INTERVAL,\n} from '../../utils/constants';\nimport { NAME } from './constants';\nimport { LOAD_ORIGIN } from '../../utils/ScriptLoader';\n\nclass Chartbeat {\n  constructor(config, analytics, destinationInfo) {\n    if (analytics.logLevel) {\n      logger.setLogLevel(analytics.logLevel);\n    }\n    this.analytics = analytics; // use this to modify failed integrations or for passing events from callback to other destinations\n    this._sf_async_config = window._sf_async_config = window._sf_async_config || {};\n    window._sf_async_config.useCanonical = true;\n    window._sf_async_config.uid = config.uid;\n    window._sf_async_config.domain = config.domain;\n    this.isVideo = !!config.video;\n    this.sendNameAndCategoryAsTitle = config.sendNameAndCategoryAsTitle || true;\n    this.subscriberEngagementKeys = config.subscriberEngagementKeys || [];\n    this.replayEvents = [];\n    this.failed = false;\n    this.isFirstPageCallMade = false;\n    this.name = NAME;\n    this.areTransformationsConnected = destinationInfo && destinationInfo.areTransformationsConnected;\n    this.destinationId = destinationInfo && destinationInfo.destinationId;\n  }\n\n  init() {\n    logger.debug('===in init Chartbeat===');\n  }\n\n  identify(rudderElement) {\n    logger.debug('in Chartbeat identify');\n  }\n\n  track(rudderElement) {\n    logger.debug('in Chartbeat track');\n  }\n\n  page(rudderElement) {\n    logger.debug('in Chartbeat page');\n    this.loadConfig(rudderElement);\n\n    if (!this.isFirstPageCallMade) {\n      this.isFirstPageCallMade = true;\n      this.initAfterPage();\n    } else {\n      if (this.failed) {\n        logger.debug('===ignoring cause failed integration===');\n        this.replayEvents = [];\n        return;\n      }\n      if (!this.isLoaded() && !this.failed) {\n        logger.debug('===pushing to replay queue for chartbeat===');\n        this.replayEvents.push(['page', rudderElement]);\n        return;\n      }\n      logger.debug('===processing page event in chartbeat===');\n      const { properties } = rudderElement.message;\n      window.pSUPERFLY.virtualPage(properties.path);\n    }\n  }\n\n  isLoaded() {\n    logger.debug('in Chartbeat isLoaded');\n    if (!this.isFirstPageCallMade) {\n      return true;\n    }\n    return !!window.pSUPERFLY;\n  }\n\n  isFailed() {\n    return this.failed;\n  }\n\n  isReady() {\n    return !!window.pSUPERFLY;\n  }\n\n  loadConfig(rudderElement) {\n    const { properties } = rudderElement.message;\n    const category = properties ? properties.category : undefined;\n    const { name } = rudderElement.message;\n    const author = properties ? properties.author : undefined;\n    let title;\n    if (this.sendNameAndCategoryAsTitle) {\n      title = category && name ? `${category} ${name}` : name;\n    }\n    if (category) window._sf_async_config.sections = category;\n    if (author) window._sf_async_config.authors = author;\n    if (title) window._sf_async_config.title = title;\n\n    const _cbq = (window._cbq = window._cbq || []);\n\n    for (const key in properties) {\n      if (!properties.hasOwnProperty(key)) continue;\n      if (this.subscriberEngagementKeys.indexOf(key) > -1) {\n        _cbq.push([key, properties[key]]);\n      }\n    }\n  }\n\n  initAfterPage() {\n    onBody(() => {\n      const script = this.isVideo ? 'chartbeat_video.js' : 'chartbeat.js';\n      function loadChartbeat() {\n        const e = document.createElement('script');\n        const n = document.getElementsByTagName('script')[0];\n        e.type = 'text/javascript';\n        e.async = true;\n        e.src = `//static.chartbeat.com/js/${script}`;\n        e.setAttribute('data-loader', LOAD_ORIGIN);\n        n.parentNode.insertBefore(e, n);\n      }\n      loadChartbeat();\n    });\n\n    this._isReady(this).then((instance) => {\n      logger.debug('===replaying on chartbeat===');\n      instance.replayEvents.forEach((event) => {\n        instance[event[0]](event[1]);\n      });\n    });\n  }\n\n  pause(time) {\n    return new Promise((resolve) => {\n      setTimeout(resolve, time);\n    });\n  }\n\n  _isReady(instance, time = 0) {\n    return new Promise((resolve) => {\n      if (this.isLoaded()) {\n        this.failed = false;\n        logger.debug('===chartbeat loaded successfully===');\n        instance.analytics.emit('ready');\n        return resolve(instance);\n      }\n      if (time >= MAX_WAIT_FOR_INTEGRATION_LOAD) {\n        this.failed = true;\n        logger.debug('===chartbeat failed===');\n        return resolve(instance);\n      }\n      this.pause(INTEGRATION_LOAD_CHECK_INTERVAL).then(() => {\n        return this._isReady(instance, time + INTEGRATION_LOAD_CHECK_INTERVAL).then(resolve);\n      });\n    });\n  }\n}\n\nexport { Chartbeat };\n"],"names":["expr","toString","Object","prototype","componentType","val","call","undefined","nodeType","_typeof","globals","componentProps","str","fn","p","arr","ret","i","length","indexOf","push","unique","replace","match","props","_","prefixed","re","map","require$$0","e","require$$1","toFunction_1","toFunction","obj","key","defaultToFunction","objectToFunction","test","Function","prop","stripNested","get","RegExp","$0","$1","type","err","require$$2","has","hasOwnProperty","array","ctx","each","this","object","charAt","string","body","callbacks","interval","setInterval","document","clearInterval","callback","LOG_LEVEL","logger","logLevel","toUpperCase","_console2","console","log","apply","arguments","INTEGRATION_LOAD_CHECK_INTERVAL","NAME","_defineProperty","_CNameMapping","Chartbeat","config","analytics","destinationInfo","_classCallCheck","_sf_async_config","window","useCanonical","uid","domain","isVideo","video","sendNameAndCategoryAsTitle","subscriberEngagementKeys","replayEvents","failed","isFirstPageCallMade","name","areTransformationsConnected","destinationId","value","rudderElement","loadConfig","isLoaded","properties","message","pSUPERFLY","virtualPage","path","initAfterPage","title","category","author","concat","sections","authors","_cbq","_this","onBody","n","script","createElement","getElementsByTagName","async","src","setAttribute","parentNode","insertBefore","_isReady","then","instance","forEach","event","time","Promise","resolve","setTimeout","_this2","emit","pause"],"mappings":"g5BAKIA,iCCAJ,IAAIC,EAAWC,OAAOC,UAAUF,gBAUlBG,EAAG,SAASC,GACxB,OAAQJ,EAASK,KAAKD,IACpB,IAAK,oBAAqB,MAAO,WACjC,IAAK,gBAAiB,MAAO,OAC7B,IAAK,kBAAmB,MAAO,SAC/B,IAAK,qBAAsB,MAAO,YAClC,IAAK,iBAAkB,MAAO,QAC9B,IAAK,kBAAmB,MAAO,SAGjC,OAAY,OAARA,EAAqB,YACbE,IAARF,EAA0B,YAC1BA,GAAwB,IAAjBA,EAAIG,SAAuB,UAClCH,IAAQH,OAAOG,GAAa,SAEhCI,EAAcJ,EAChB,iCC3BA,IAAIK,EAAU,4CAWdC,EAAiB,SAASC,EAAKC,GAC7B,IAAIC,EAiDN,SAAgBC,GAGd,IAFA,IAAIC,EAAM,GAEDC,EAAI,EAAGA,EAAIF,EAAIG,OAAQD,KACzBD,EAAIG,QAAQJ,EAAIE,KACrBD,EAAII,KAAKL,EAAIE,IAGf,OAAOD,CACT,CA1DUK,CAcV,SAAeT,GACb,OAAOA,EACJU,QAAQ,6CAA8C,IACtDA,QAAQZ,EAAS,IACjBa,MAAM,kBACJ,EACP,CApBiBC,CAAMZ,IAErB,OADIC,GAAM,iBAAmBA,IAAIA,EA+DnC,SAAkBD,GAChB,OAAgBa,SAAAA,GACd,OAAOb,EAAMa,CACjB,CACA,CAnEwCC,CAASb,IAC3CA,EA8BN,SAAaD,EAAKY,EAAOX,GACvB,IAAIc,EAAK,0DACT,OAAOf,EAAIU,QAAQK,GAAI,SAASF,GAC9B,MAAI,KAAOA,EAAEA,EAAEP,OAAS,KAClBM,EAAML,QAAQM,GADeZ,EAAGY,GACPA,CAEnC,GACA,CArCiBG,CAAIhB,EAAKE,EAAGD,GACpBC,CACT,IFdA,IACEd,EAAO6B,GAGT,CAFE,MAAMC,GACN9B,EAAO+B,GACT,KAMAC,EAAiBC,EAUjB,SAASA,EAAWC,GAClB,OAAQ,CAAE,EAACjC,SAASK,KAAK4B,IACvB,IAAK,kBACH,OAgEN,SAA0BA,GACxB,IAAIX,EAAQ,CAAE,EACd,IAAK,IAAIY,KAAOD,EACdX,EAAMY,GAA2B,iBAAbD,EAAIC,GACpBC,EAAkBF,EAAIC,IACtBF,EAAWC,EAAIC,IAErB,gBAAgB9B,GACd,GAAmB,WAAfI,EAAOJ,GAAkB,OAAY,EACzC,IAAK,IAAI8B,KAAOZ,EAAO,CACrB,KAAMY,KAAO9B,GAAM,OAAY,EAC/B,IAAKkB,EAAMY,GAAK9B,EAAI8B,IAAO,OAAY,CACxC,CACD,OAAW,CACf,CACA,CA/EaE,CAAiBH,GAC1B,IAAK,oBACH,OAAOA,EACT,IAAK,kBACH,MA8CA,SAASI,KAFW1B,EA5CIsB,GA8CG,IAAIK,SAAS,IAAK,YAAc3B,GAGpD,IAAA2B,SAAS,IAAK,UAoC3B,SAAa3B,GACX,IAGIP,EAAKY,EAAGuB,EAHRhB,EAAQxB,EAAKY,GACjB,IAAKY,EAAMN,OAAQ,MAAO,KAAON,EAGjC,IAAKK,EAAI,EAAGA,EAAIO,EAAMN,OAAQD,IAM5BL,EAAM6B,EALND,EAAOhB,EAAMP,GAKWL,EAHxBP,EAAM,0BADNA,EAAM,KAAOmC,GAC0B,MAAQnC,EAAM,QAAUA,EAAM,KAMvE,OAAOO,CACT,CAnDuC8B,CAAI9B,IAhDvC,IAAK,kBACH,OA4BoBe,EA5BIO,EA6BrB,SAASA,GACd,OAAOP,EAAGW,KAAKJ,EACnB,EA9BI,QACE,OAAOE,EAAkBF,GA0B/B,IAA0BP,EAcAf,CAtC1B,CAUA,SAASwB,EAAkB/B,GACzB,OAAgB6B,SAAAA,GACd,OAAO7B,IAAQ6B,CACnB,CACA,CA8FA,SAASO,EAAaD,EAAM5B,EAAKP,GAC/B,OAAOO,EAAIU,QAAQ,IAAIqB,OAAO,SAAWH,EAAM,MAAM,SAASI,EAAIC,GAChE,OAAOA,EAAKD,EAAKvC,CACrB,GACA,CGlJA,IACE,IAAIyC,EAAOjB,GAGb,CAFE,MAAOkB,GACHD,EAAOf,GACb,CAEA,IAAIE,EAAae,EAMbC,EAAM/C,OAAOC,UAAU+C,eAmE3B,SAASC,EAAMjB,EAAKrB,EAAIuC,GACtB,IAAK,IAAInC,EAAI,EAAGA,EAAIiB,EAAIhB,SAAUD,EAChCJ,EAAGP,KAAK8C,EAAKlB,EAAIjB,GAAIA,EAEzB,CCxFA,IAAIoC,ED6Ba,SAASnB,EAAKrB,EAAIuC,GAGjC,OAFAvC,EAAKoB,EAAWpB,GAChBuC,EAAMA,GAAOE,KACLR,EAAKZ,IACX,IAAK,QACH,OAAOiB,EAAMjB,EAAKrB,EAAIuC,GACxB,IAAK,SACH,MAAI,iBAAmBlB,EAAIhB,OAAeiC,EAAMjB,EAAKrB,EAAIuC,GA+B/D,SAAgBlB,EAAKrB,EAAIuC,GACvB,IAAK,IAAIjB,KAAOD,EACVe,EAAI3C,KAAK4B,EAAKC,IAChBtB,EAAGP,KAAK8C,EAAKjB,EAAKD,EAAIC,GAG5B,CApCaoB,CAAOrB,EAAKrB,EAAIuC,GACzB,IAAK,SACH,OAaN,SAAgBlB,EAAKrB,EAAIuC,GACvB,IAAK,IAAInC,EAAI,EAAGA,EAAIiB,EAAIhB,SAAUD,EAChCJ,EAAGP,KAAK8C,EAAKlB,EAAIsB,OAAOvC,GAAIA,EAEhC,CAjBawC,CAAOvB,EAAKrB,EAAIuC,GAE7B,EClCIM,GAAO,EAOPC,EAAY,GAsBZC,EAAWC,aAAY,WACpBC,SAASJ,OACdA,GAAO,EACPL,EAAKM,EAAWrD,GAChByD,cAAcH,GAChB,GAAG,GASH,SAAStD,EAAM0D,GACbA,EAASF,SAASJ,KACpB,CCpDA,MAKIO,EAFoB,EAIlBC,EACO,SAACC,GACV,OAAQA,EAASC,eACf,IAAK,OACHH,EAXe,EAYf,MACF,IAAK,QACHA,EAbgB,EAchB,MACF,IAAK,OACHA,EAfe,EAgBf,MACF,QACEA,EAjBgB,EAoBtB,EAhBIC,EAwBC,WAC+B,IAAAG,EAA9BJ,GA/BgB,IAgClBI,EAAAC,SAAQC,IAAGC,MAAAH,EAAAI,UAEf,ECfIC,EAAkC,ICpBlCC,EAAO,YACKC,EAAAC,EAAAD,CAAAA,EACfD,EAAOA,GAAIC,EAAAC,EACDF,YAAAA,GAAIC,EAAAC,EAAA,YACJF,GAAIC,EAAAC,EACf,aAAcF,GAAIC,EAAAC,EAClB,aAAcF,GCCH,ICGPG,EAAS,WACb,SAAAA,EAAYC,EAAQC,EAAWC,gGAAiBC,CAAA5B,KAAAwB,GAC1CE,EAAUb,UACZD,EAAmBc,EAAUb,UAE/Bb,KAAK0B,UAAYA,EACjB1B,KAAK6B,iBAAmBC,OAAOD,iBAAmBC,OAAOD,kBAAoB,CAAA,EAC7EC,OAAOD,iBAAiBE,cAAe,EACvCD,OAAOD,iBAAiBG,IAAMP,EAAOO,IACrCF,OAAOD,iBAAiBI,OAASR,EAAOQ,OACxCjC,KAAKkC,UAAYT,EAAOU,MACxBnC,KAAKoC,2BAA6BX,EAAOW,6BAA8B,EACvEpC,KAAKqC,yBAA2BZ,EAAOY,0BAA4B,GACnErC,KAAKsC,aAAe,GACpBtC,KAAKuC,QAAS,EACdvC,KAAKwC,qBAAsB,EAC3BxC,KAAKyC,KAAOpB,EACZrB,KAAK0C,4BAA8Bf,GAAmBA,EAAgBe,4BACtE1C,KAAK2C,cAAgBhB,GAAmBA,EAAgBgB,aAC1D,WA2HCnB,SA3HAA,IAAA,CAAA,CAAA3C,IAAA+D,OAAAA,MAED,WACEhC,EAAa,0BACf,GAAC,CAAA/B,IAAA,WAAA+D,MAED,SAASC,GACPjC,EAAa,wBACf,GAAC,CAAA/B,IAAA+D,QAAAA,MAED,SAAMC,GACJjC,EAAa,qBACf,GAAC,CAAA/B,IAAA,OAAA+D,MAED,SAAKC,GAIH,GAHAjC,EAAa,qBACbZ,KAAK8C,WAAWD,GAEX7C,KAAKwC,oBAGH,CACL,GAAIxC,KAAKuC,OAGP,OAFA3B,EAAa,gDACbZ,KAAKsC,aAAe,IAGtB,IAAKtC,KAAK+C,aAAe/C,KAAKuC,OAG5B,OAFA3B,EAAa,oDACbZ,KAAKsC,aAAaxE,KAAK,CAAC,OAAQ+E,IAGlCjC,EAAa,4CACb,IAAQoC,EAAeH,EAAcI,QAA7BD,WACRlB,OAAOoB,UAAUC,YAAYH,EAAWI,KAC1C,MAhBEpD,KAAKwC,qBAAsB,EAC3BxC,KAAKqD,eAgBT,GAAC,CAAAxE,IAAA,WAAA+D,MAED,WAEE,OADAhC,EAAa,0BACRZ,KAAKwC,uBAGDV,OAAOoB,SAClB,GAACrE,CAAAA,eAAA+D,MAED,WACE,OAAW5C,KAACuC,MACd,GAAC,CAAA1D,IAAA+D,UAAAA,MAED,WACE,QAASd,OAAOoB,SAClB,GAAC,CAAArE,IAAA,aAAA+D,MAED,SAAWC,GACT,IAIIS,EAJIN,EAAeH,EAAcI,QAA7BD,WACFO,EAAWP,EAAaA,EAAWO,cAAWtG,EAC5CwF,EAASI,EAAcI,QAAvBR,KACFe,EAASR,EAAaA,EAAWQ,YAASvG,EAE5C+C,KAAKoC,6BACPkB,EAAQC,GAAYd,EAAI,GAAAgB,OAAMF,OAAQE,OAAIhB,GAASA,GAEjDc,IAAUzB,OAAOD,iBAAiB6B,SAAWH,GAC7CC,IAAQ1B,OAAOD,iBAAiB8B,QAAUH,GAC1CF,IAAOxB,OAAOD,iBAAiByB,MAAQA,GAE3C,IAAMM,EAAQ9B,OAAO8B,KAAO9B,OAAO8B,MAAQ,GAE3C,IAAK,IAAM/E,KAAOmE,EACXA,EAAWpD,eAAef,IAC3BmB,KAAKqC,yBAAyBxE,QAAQgB,IAAQ,GAChD+E,EAAK9F,KAAK,CAACe,EAAKmE,EAAWnE,IAGjC,GAACA,CAAAA,oBAAA+D,MAED,WAAgBiB,ILnFgBnD,EKmFhBmD,EACdC,KLpF8BpD,EKoFvB,WACL,IAEQlC,EACAuF,EAHFC,EAASH,EAAK3B,QAAU,qBAAuB,eAE7C1D,EAAIgC,SAASyD,cAAc,UAC3BF,EAAIvD,SAAS0D,qBAAqB,UAAU,GAClD1F,EAAEgB,KAAO,kBACThB,EAAE2F,OAAQ,EACV3F,EAAE4F,IAAG,6BAAAX,OAAgCO,GACrCxF,EAAE6F,aAAa,cD5GI,aC6GnBN,EAAEO,WAAWC,aAAa/F,EAAGuF,EAGjC,EL/FE3D,EACFpD,EAAK0D,GAELL,EAAUvC,KAAK4C,GK8FfV,KAAKwE,SAASxE,MAAMyE,MAAK,SAACC,GACxB9D,EAAa,gCACb8D,EAASpC,aAAaqC,SAAQ,SAACC,GAC7BF,EAASE,EAAM,IAAIA,EAAM,GAC3B,GACF,GACF,IAAC/F,IAAA,QAAA+D,MAED,SAAMiC,GACJ,OAAW,IAAAC,SAAQ,SAACC,GAClBC,WAAWD,EAASF,EACtB,GACF,GAAChG,CAAAA,IAAA+D,WAAAA,MAED,SAAS8B,GAAoBO,IAAAA,OAAVJ,EAAI1D,UAAAvD,eAAAX,IAAAkE,UAAA,GAAAA,UAAA,GAAG,EACxB,OAAW,IAAA2D,SAAQ,SAACC,GAClB,OAAIE,EAAKlC,YACPkC,EAAK1C,QAAS,EACd3B,EAAa,uCACb8D,EAAShD,UAAUwD,KAAK,SACjBH,EAAQL,IAEbG,GH5H4B,KG6H9BI,EAAK1C,QAAS,EACd3B,EAAa,0BACNmE,EAAQL,SAEjBO,EAAKE,MAAM/D,GAAiCqD,MAAK,WAC/C,OAAOQ,EAAKT,SAASE,EAAUG,EAAOzD,GAAiCqD,KAAKM,EAC9E,GACF,GACF,qFAACvD,CAGH,CAjJe"}