{"version":3,"file":"Chartbeat.min.js","sources":["../../../node_modules/component-each/node_modules/component-type/index.js","../../../node_modules/component-props/index.js","../../../node_modules/to-function/index.js","../../../node_modules/component-each/index.js","../../../node_modules/on-body/index.js","../../../src/utils/logUtil.js","../../../src/utils/constants.js","../../../src/integrations/Chartbeat/constants.js","../../../src/utils/ScriptLoader.js","../../../src/integrations/Chartbeat/browser.js"],"sourcesContent":["\n/**\n * toString ref.\n */\n\nvar toString = Object.prototype.toString;\n\n/**\n * Return the type of `val`.\n *\n * @param {Mixed} val\n * @return {String}\n * @api public\n */\n\nmodule.exports = function(val){\n  switch (toString.call(val)) {\n    case '[object Function]': return 'function';\n    case '[object Date]': return 'date';\n    case '[object RegExp]': return 'regexp';\n    case '[object Arguments]': return 'arguments';\n    case '[object Array]': return 'array';\n    case '[object String]': return 'string';\n  }\n\n  if (val === null) return 'null';\n  if (val === undefined) return 'undefined';\n  if (val && val.nodeType === 1) return 'element';\n  if (val === Object(val)) return 'object';\n\n  return typeof val;\n};\n","/**\n * Global Names\n */\n\nvar globals = /\\b(Array|Date|Object|Math|JSON)\\b/g;\n\n/**\n * Return immediate identifiers parsed from `str`.\n *\n * @param {String} str\n * @param {String|Function} map function or prefix\n * @return {Array}\n * @api public\n */\n\nmodule.exports = function(str, fn){\n  var p = unique(props(str));\n  if (fn && 'string' == typeof fn) fn = prefixed(fn);\n  if (fn) return map(str, p, fn);\n  return p;\n};\n\n/**\n * Return immediate identifiers in `str`.\n *\n * @param {String} str\n * @return {Array}\n * @api private\n */\n\nfunction props(str) {\n  return str\n    .replace(/\\.\\w+|\\w+ *\\(|\"[^\"]*\"|'[^']*'|\\/([^/]+)\\//g, '')\n    .replace(globals, '')\n    .match(/[a-zA-Z_]\\w*/g)\n    || [];\n}\n\n/**\n * Return `str` with `props` mapped with `fn`.\n *\n * @param {String} str\n * @param {Array} props\n * @param {Function} fn\n * @return {String}\n * @api private\n */\n\nfunction map(str, props, fn) {\n  var re = /\\.\\w+|\\w+ *\\(|\"[^\"]*\"|'[^']*'|\\/([^/]+)\\/|[a-zA-Z_]\\w*/g;\n  return str.replace(re, function(_){\n    if ('(' == _[_.length - 1]) return fn(_);\n    if (!~props.indexOf(_)) return _;\n    return fn(_);\n  });\n}\n\n/**\n * Return unique array.\n *\n * @param {Array} arr\n * @return {Array}\n * @api private\n */\n\nfunction unique(arr) {\n  var ret = [];\n\n  for (var i = 0; i < arr.length; i++) {\n    if (~ret.indexOf(arr[i])) continue;\n    ret.push(arr[i]);\n  }\n\n  return ret;\n}\n\n/**\n * Map with prefix `str`.\n */\n\nfunction prefixed(str) {\n  return function(_){\n    return str + _;\n  };\n}\n","\n/**\n * Module Dependencies\n */\n\nvar expr;\ntry {\n  expr = require('props');\n} catch(e) {\n  expr = require('component-props');\n}\n\n/**\n * Expose `toFunction()`.\n */\n\nmodule.exports = toFunction;\n\n/**\n * Convert `obj` to a `Function`.\n *\n * @param {Mixed} obj\n * @return {Function}\n * @api private\n */\n\nfunction toFunction(obj) {\n  switch ({}.toString.call(obj)) {\n    case '[object Object]':\n      return objectToFunction(obj);\n    case '[object Function]':\n      return obj;\n    case '[object String]':\n      return stringToFunction(obj);\n    case '[object RegExp]':\n      return regexpToFunction(obj);\n    default:\n      return defaultToFunction(obj);\n  }\n}\n\n/**\n * Default to strict equality.\n *\n * @param {Mixed} val\n * @return {Function}\n * @api private\n */\n\nfunction defaultToFunction(val) {\n  return function(obj){\n    return val === obj;\n  };\n}\n\n/**\n * Convert `re` to a function.\n *\n * @param {RegExp} re\n * @return {Function}\n * @api private\n */\n\nfunction regexpToFunction(re) {\n  return function(obj){\n    return re.test(obj);\n  };\n}\n\n/**\n * Convert property `str` to a function.\n *\n * @param {String} str\n * @return {Function}\n * @api private\n */\n\nfunction stringToFunction(str) {\n  // immediate such as \"> 20\"\n  if (/^ *\\W+/.test(str)) return new Function('_', 'return _ ' + str);\n\n  // properties such as \"name.first\" or \"age > 18\" or \"age > 18 && age < 36\"\n  return new Function('_', 'return ' + get(str));\n}\n\n/**\n * Convert `object` to a function.\n *\n * @param {Object} object\n * @return {Function}\n * @api private\n */\n\nfunction objectToFunction(obj) {\n  var match = {};\n  for (var key in obj) {\n    match[key] = typeof obj[key] === 'string'\n      ? defaultToFunction(obj[key])\n      : toFunction(obj[key]);\n  }\n  return function(val){\n    if (typeof val !== 'object') return false;\n    for (var key in match) {\n      if (!(key in val)) return false;\n      if (!match[key](val[key])) return false;\n    }\n    return true;\n  };\n}\n\n/**\n * Built the getter function. Supports getter style functions\n *\n * @param {String} str\n * @return {String}\n * @api private\n */\n\nfunction get(str) {\n  var props = expr(str);\n  if (!props.length) return '_.' + str;\n\n  var val, i, prop;\n  for (i = 0; i < props.length; i++) {\n    prop = props[i];\n    val = '_.' + prop;\n    val = \"('function' == typeof \" + val + \" ? \" + val + \"() : \" + val + \")\";\n\n    // mimic negative lookbehind to avoid problems with nested properties\n    str = stripNested(prop, str, val);\n  }\n\n  return str;\n}\n\n/**\n * Mimic negative lookbehind to avoid problems with nested properties.\n *\n * See: http://blog.stevenlevithan.com/archives/mimic-lookbehind-javascript\n *\n * @param {String} prop\n * @param {String} str\n * @param {String} val\n * @return {String}\n * @api private\n */\n\nfunction stripNested (prop, str, val) {\n  return str.replace(new RegExp('(\\\\.)?' + prop, 'g'), function($0, $1) {\n    return $1 ? $0 : val;\n  });\n}\n","\n/**\n * Module dependencies.\n */\n\ntry {\n  var type = require('type');\n} catch (err) {\n  var type = require('component-type');\n}\n\nvar toFunction = require('to-function');\n\n/**\n * HOP reference.\n */\n\nvar has = Object.prototype.hasOwnProperty;\n\n/**\n * Iterate the given `obj` and invoke `fn(val, i)`\n * in optional context `ctx`.\n *\n * @param {String|Array|Object} obj\n * @param {Function} fn\n * @param {Object} [ctx]\n * @api public\n */\n\nmodule.exports = function(obj, fn, ctx){\n  fn = toFunction(fn);\n  ctx = ctx || this;\n  switch (type(obj)) {\n    case 'array':\n      return array(obj, fn, ctx);\n    case 'object':\n      if ('number' == typeof obj.length) return array(obj, fn, ctx);\n      return object(obj, fn, ctx);\n    case 'string':\n      return string(obj, fn, ctx);\n  }\n};\n\n/**\n * Iterate string chars.\n *\n * @param {String} obj\n * @param {Function} fn\n * @param {Object} ctx\n * @api private\n */\n\nfunction string(obj, fn, ctx) {\n  for (var i = 0; i < obj.length; ++i) {\n    fn.call(ctx, obj.charAt(i), i);\n  }\n}\n\n/**\n * Iterate object keys.\n *\n * @param {Object} obj\n * @param {Function} fn\n * @param {Object} ctx\n * @api private\n */\n\nfunction object(obj, fn, ctx) {\n  for (var key in obj) {\n    if (has.call(obj, key)) {\n      fn.call(ctx, key, obj[key]);\n    }\n  }\n}\n\n/**\n * Iterate array-ish.\n *\n * @param {Array|Object} obj\n * @param {Function} fn\n * @param {Object} ctx\n * @api private\n */\n\nfunction array(obj, fn, ctx) {\n  for (var i = 0; i < obj.length; ++i) {\n    fn.call(ctx, obj[i], i);\n  }\n}\n","var each = require('each');\n\n\n/**\n * Cache whether `<body>` exists.\n */\n\nvar body = false;\n\n\n/**\n * Callbacks to call when the body exists.\n */\n\nvar callbacks = [];\n\n\n/**\n * Export a way to add handlers to be invoked once the body exists.\n *\n * @param {Function} callback  A function to call when the body exists.\n */\n\nmodule.exports = function onBody (callback) {\n  if (body) {\n    call(callback);\n  } else {\n    callbacks.push(callback);\n  }\n};\n\n\n/**\n * Set an interval to check for `document.body`.\n */\n\nvar interval = setInterval(function () {\n  if (!document.body) return;\n  body = true;\n  each(callbacks, call);\n  clearInterval(interval);\n}, 5);\n\n\n/**\n * Call a callback, passing it the body.\n *\n * @param {Function} callback  The callback to call.\n */\n\nfunction call (callback) {\n  callback(document.body);\n}","const LOG_LEVEL_INFO = 1;\nconst LOG_LEVEL_DEBUG = 2;\nconst LOG_LEVEL_WARN = 3;\nconst LOG_LEVEL_ERROR = 4;\nconst DEF_LOG_LEVEL = LOG_LEVEL_ERROR;\nlet LOG_LEVEL = DEF_LOG_LEVEL;\n\nconst logger = {\n  setLogLevel(logLevel) {\n    switch (logLevel.toUpperCase()) {\n      case 'INFO':\n        LOG_LEVEL = LOG_LEVEL_INFO;\n        break;\n      case 'DEBUG':\n        LOG_LEVEL = LOG_LEVEL_DEBUG;\n        break;\n      case 'WARN':\n        LOG_LEVEL = LOG_LEVEL_WARN;\n        break;\n      default:\n        LOG_LEVEL = DEF_LOG_LEVEL;\n        break;\n    }\n  },\n\n  info(...args) {\n    if (LOG_LEVEL <= LOG_LEVEL_INFO) {\n      console.info(...args);\n    }\n  },\n\n  debug(...args) {\n    if (LOG_LEVEL <= LOG_LEVEL_DEBUG) {\n      console.log(...args);\n    }\n  },\n\n  warn(...args) {\n    if (LOG_LEVEL <= LOG_LEVEL_WARN) {\n      console.warn(...args);\n    }\n  },\n\n  error(...args) {\n    if (LOG_LEVEL <= LOG_LEVEL_ERROR) {\n      console.error(...args);\n    }\n  },\n};\n\nexport default logger;\n","// Reserved Keywords for properties/traits\nconst RESERVED_KEYS = [\n  'anonymous_id',\n  'id',\n  'sent_at',\n  'received_at',\n  'timestamp',\n  'original_timestamp',\n  'event_text',\n  'event',\n];\n\nconst CONFIG_URL =\n  'https://api.rudderlabs.com/sourceConfig/?p=__MODULE_TYPE__&v=__PACKAGE_VERSION__';\nconst SDK_CDN_BASE_URL = 'https://cdn.rudderlabs.com';\nconst CDN_ARCH_VERSION_DIR = 'v1.1';\nconst CDN_INT_DIR = 'js-integrations';\nconst DEST_SDK_BASE_URL = `${SDK_CDN_BASE_URL}/${CDN_ARCH_VERSION_DIR}/${CDN_INT_DIR}`;\n\nconst MAX_WAIT_FOR_INTEGRATION_LOAD = 10000;\nconst INTEGRATION_LOAD_CHECK_INTERVAL = 1000;\nconst INTG_SUFFIX = '_RS';\nconst POLYFILL_URL =\n  'https://polyfill.io/v3/polyfill.min.js?features=Array.prototype.find%2CArray.prototype.includes%2CPromise%2CString.prototype.endsWith%2CString.prototype.includes%2CString.prototype.startsWith%2CObject.entries%2CObject.values%2CElement.prototype.dataset%2CString.prototype.replaceAll';\n\nconst GENERIC_TRUE_VALUES = ['true', 'True', 'TRUE', 't', 'T', '1'];\nconst GENERIC_FALSE_VALUES = ['false', 'False', 'FALSE', 'f', 'F', '0'];\n\nconst SAMESITE_COOKIE_OPTS = ['Lax', 'None', 'Strict'];\n\nconst DEFAULT_SESSION_TIMEOUT = 30 * 60 * 1000; // 30 min in milliseconds\nconst MIN_SESSION_TIMEOUT = 10 * 1000; // 10 sec in milliseconds\nconst MIN_SESSION_ID_LENGTH = 10;\n\nconst ERROR_REPORTING_SERVICE_GLOBAL_KEY_NAME = 'errorReporting';\nconst LOAD_ORIGIN = 'RS_JS_SDK';\n\nconst DEFAULT_REGION = 'US';\nconst DEFAULT_DATAPLANE_URL = 'https://hosted.rudderlabs.com';\n\nconst RESIDENCY_SERVERS = [DEFAULT_REGION, 'EU'];\n\nconst SUPPORTED_CONSENT_MANAGERS = ['oneTrust'];\n\nconst SYSTEM_KEYWORDS = ['library', 'consentManagement'];\nconst UA_CH_LEVELS = ['none', 'default', 'full'];\n\nexport {\n  RESERVED_KEYS,\n  CONFIG_URL,\n  SDK_CDN_BASE_URL,\n  CDN_ARCH_VERSION_DIR,\n  CDN_INT_DIR,\n  DEST_SDK_BASE_URL,\n  MAX_WAIT_FOR_INTEGRATION_LOAD,\n  INTEGRATION_LOAD_CHECK_INTERVAL,\n  INTG_SUFFIX,\n  POLYFILL_URL,\n  GENERIC_TRUE_VALUES,\n  GENERIC_FALSE_VALUES,\n  SAMESITE_COOKIE_OPTS,\n  DEFAULT_SESSION_TIMEOUT,\n  MIN_SESSION_TIMEOUT,\n  MIN_SESSION_ID_LENGTH,\n  ERROR_REPORTING_SERVICE_GLOBAL_KEY_NAME,\n  LOAD_ORIGIN,\n  DEFAULT_REGION,\n  DEFAULT_DATAPLANE_URL,\n  RESIDENCY_SERVERS,\n  SUPPORTED_CONSENT_MANAGERS,\n  SYSTEM_KEYWORDS,\n  UA_CH_LEVELS,\n};\n","const NAME = 'CHARTBEAT';\nconst CNameMapping = {\n  [NAME]: NAME,\n  Chartbeat: NAME,\n  chartbeat: NAME,\n  'Chart Beat': NAME,\n  'chart beat': NAME,\n};\n\nexport { NAME, CNameMapping };\n","/* eslint-disable no-use-before-define */\n// import logger from \"../utils/logUtil\";\n\nimport { handleError } from \"./errorHandler\";\n\nconst defaultAsyncState = true;\n\nexport const LOAD_ORIGIN = 'RS_JS_SDK';\n/**\n * Script loader\n * @param {String} id                               Id of the script\n * @param {String} src                              URL of the script\n * @param {Object} options                          Object containing different configuration\n * @param {Boolean} options.async                   Determines script will be loaded asynchronously or not\n * @param {Boolean} options.isNonNativeSDK          Determines whether the script that will be loaded is one of RS's own\n * @param {Boolean} options.skipDatasetAttributes   Determines whether to add or skip dataset attribute\n */\nconst ScriptLoader = (id, src, options = {}) => {\n  try {\n    const exists = document.getElementById(id);\n    if (exists) {\n      // logger.debug(\"script already loaded\");\n      return;\n    }\n\n    const js = document.createElement('script');\n    js.src = src;\n    js.async = options.async === undefined ? defaultAsyncState : options.async;\n    js.type = 'text/javascript';\n    js.id = id;\n    // This checking is in place to skip the dataset attribute for some cases(while loading polyfill)\n    if (options.skipDatasetAttributes !== true) {\n      js.setAttribute('data-loader', LOAD_ORIGIN);\n      if (options.isNonNativeSDK !== undefined) {\n        js.setAttribute('data-isNonNativeSDK', options.isNonNativeSDK);\n      }\n    }\n    const headElmColl = document.getElementsByTagName('head');\n    if (headElmColl.length > 0) {\n      // logger.debug(\"==adding script==\", js);\n      headElmColl[0].insertBefore(js, headElmColl[0].firstChild);\n    } else {\n      const e = document.getElementsByTagName('script')[0];\n      // logger.debug(\"==parent script==\", e);\n      // logger.debug(\"==adding script==\", js);\n      e.parentNode.insertBefore(js, e);\n    }\n  } catch (e) {\n    handleError(e);\n  }\n};\n\nexport default ScriptLoader;\n","/* eslint-disable class-methods-use-this */\nimport onBody from 'on-body';\nimport logger from '../../utils/logUtil';\nimport {\n  MAX_WAIT_FOR_INTEGRATION_LOAD,\n  INTEGRATION_LOAD_CHECK_INTERVAL,\n} from '../../utils/constants';\nimport { NAME } from './constants';\nimport { LOAD_ORIGIN } from '../../utils/ScriptLoader';\n\nclass Chartbeat {\n  constructor(config, analytics, destinationInfo) {\n    if (analytics.logLevel) {\n      logger.setLogLevel(analytics.logLevel);\n    }\n    this.analytics = analytics; // use this to modify failed integrations or for passing events from callback to other destinations\n    this._sf_async_config = window._sf_async_config = window._sf_async_config || {};\n    window._sf_async_config.useCanonical = true;\n    window._sf_async_config.uid = config.uid;\n    window._sf_async_config.domain = config.domain;\n    this.isVideo = !!config.video;\n    this.sendNameAndCategoryAsTitle = config.sendNameAndCategoryAsTitle || true;\n    this.subscriberEngagementKeys = config.subscriberEngagementKeys || [];\n    this.replayEvents = [];\n    this.failed = false;\n    this.isFirstPageCallMade = false;\n    this.name = NAME;\n    this.areTransformationsConnected = destinationInfo && destinationInfo.areTransformationsConnected;\n    this.destinationId = destinationInfo && destinationInfo.destinationId;\n  }\n\n  init() {\n    logger.debug('===in init Chartbeat===');\n  }\n\n  identify(rudderElement) {\n    logger.debug('in Chartbeat identify');\n  }\n\n  track(rudderElement) {\n    logger.debug('in Chartbeat track');\n  }\n\n  page(rudderElement) {\n    logger.debug('in Chartbeat page');\n    this.loadConfig(rudderElement);\n\n    if (!this.isFirstPageCallMade) {\n      this.isFirstPageCallMade = true;\n      this.initAfterPage();\n    } else {\n      if (this.failed) {\n        logger.debug('===ignoring cause failed integration===');\n        this.replayEvents = [];\n        return;\n      }\n      if (!this.isLoaded() && !this.failed) {\n        logger.debug('===pushing to replay queue for chartbeat===');\n        this.replayEvents.push(['page', rudderElement]);\n        return;\n      }\n      logger.debug('===processing page event in chartbeat===');\n      const { properties } = rudderElement.message;\n      window.pSUPERFLY.virtualPage(properties.path);\n    }\n  }\n\n  isLoaded() {\n    logger.debug('in Chartbeat isLoaded');\n    if (!this.isFirstPageCallMade) {\n      return true;\n    }\n    return !!window.pSUPERFLY;\n  }\n\n  isFailed() {\n    return this.failed;\n  }\n\n  isReady() {\n    return !!window.pSUPERFLY;\n  }\n\n  loadConfig(rudderElement) {\n    const { properties } = rudderElement.message;\n    const category = properties ? properties.category : undefined;\n    const { name } = rudderElement.message;\n    const author = properties ? properties.author : undefined;\n    let title;\n    if (this.sendNameAndCategoryAsTitle) {\n      title = category && name ? `${category} ${name}` : name;\n    }\n    if (category) window._sf_async_config.sections = category;\n    if (author) window._sf_async_config.authors = author;\n    if (title) window._sf_async_config.title = title;\n\n    const _cbq = (window._cbq = window._cbq || []);\n\n    for (const key in properties) {\n      if (!properties.hasOwnProperty(key)) continue;\n      if (this.subscriberEngagementKeys.indexOf(key) > -1) {\n        _cbq.push([key, properties[key]]);\n      }\n    }\n  }\n\n  initAfterPage() {\n    onBody(() => {\n      const script = this.isVideo ? 'chartbeat_video.js' : 'chartbeat.js';\n      function loadChartbeat() {\n        const e = document.createElement('script');\n        const n = document.getElementsByTagName('script')[0];\n        e.type = 'text/javascript';\n        e.async = true;\n        e.src = `//static.chartbeat.com/js/${script}`;\n        e.setAttribute('data-loader', LOAD_ORIGIN);\n        n.parentNode.insertBefore(e, n);\n      }\n      loadChartbeat();\n    });\n\n    this._isReady(this).then((instance) => {\n      logger.debug('===replaying on chartbeat===');\n      instance.replayEvents.forEach((event) => {\n        instance[event[0]](event[1]);\n      });\n    });\n  }\n\n  pause(time) {\n    return new Promise((resolve) => {\n      setTimeout(resolve, time);\n    });\n  }\n\n  _isReady(instance, time = 0) {\n    return new Promise((resolve) => {\n      if (this.isLoaded()) {\n        this.failed = false;\n        logger.debug('===chartbeat loaded successfully===');\n        instance.analytics.emit('ready');\n        return resolve(instance);\n      }\n      if (time >= MAX_WAIT_FOR_INTEGRATION_LOAD) {\n        this.failed = true;\n        logger.debug('===chartbeat failed===');\n        return resolve(instance);\n      }\n      this.pause(INTEGRATION_LOAD_CHECK_INTERVAL).then(() => {\n        return this._isReady(instance, time + INTEGRATION_LOAD_CHECK_INTERVAL).then(resolve);\n      });\n    });\n  }\n}\n\nexport { Chartbeat };\n"],"names":["Object","prototype","toString","componentType","val","call","undefined","nodeType","globals","componentProps","str","fn","p","arr","ret","i","length","indexOf","push","unique","replace","match","props","_","prefixed","re","map","expr","require$$0","e","require$$1","toFunction_1","toFunction","obj","key","defaultToFunction","_typeof","objectToFunction","test","Function","prop","stripNested","get","RegExp","$0","$1","type","err","require$$2","hasOwnProperty","ctx","each","this","has","object","charAt","string","body","callbacks","interval","setInterval","document","clearInterval","callback","LOG_LEVEL","logger","logLevel","toUpperCase","_console2","console","log","apply","arguments","INTEGRATION_LOAD_CHECK_INTERVAL","NAME","_defineProperty","_CNameMapping","Chartbeat","config","analytics","destinationInfo","_classCallCheck","_sf_async_config","window","useCanonical","uid","domain","isVideo","video","sendNameAndCategoryAsTitle","subscriberEngagementKeys","replayEvents","failed","isFirstPageCallMade","name","areTransformationsConnected","destinationId","value","rudderElement","loadConfig","isLoaded","properties","message","pSUPERFLY","virtualPage","path","initAfterPage","title","category","author","concat","sections","authors","_cbq","n","_this","createElement","getElementsByTagName","async","src","script","setAttribute","parentNode","insertBefore","_isReady","then","instance","forEach","event","time","Promise","resolve","setTimeout","_this2","emit","pause"],"mappings":"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"}