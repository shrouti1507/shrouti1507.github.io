{"version":3,"file":"Qualtrics.min.js","sources":["../../../src/utils/logUtil.js","../../../src/integrations/Qualtrics/constants.js","../../../src/integrations/Qualtrics/browser.js","../../../src/utils/ScriptLoader.js"],"sourcesContent":["const LOG_LEVEL_INFO = 1;\nconst LOG_LEVEL_DEBUG = 2;\nconst LOG_LEVEL_WARN = 3;\nconst LOG_LEVEL_ERROR = 4;\nconst DEF_LOG_LEVEL = LOG_LEVEL_ERROR;\nlet LOG_LEVEL = DEF_LOG_LEVEL;\n\nconst logger = {\n  setLogLevel(logLevel) {\n    switch (logLevel.toUpperCase()) {\n      case 'INFO':\n        LOG_LEVEL = LOG_LEVEL_INFO;\n        break;\n      case 'DEBUG':\n        LOG_LEVEL = LOG_LEVEL_DEBUG;\n        break;\n      case 'WARN':\n        LOG_LEVEL = LOG_LEVEL_WARN;\n        break;\n      default:\n        LOG_LEVEL = DEF_LOG_LEVEL;\n        break;\n    }\n  },\n\n  info(...args) {\n    if (LOG_LEVEL <= LOG_LEVEL_INFO) {\n      console.info(...args);\n    }\n  },\n\n  debug(...args) {\n    if (LOG_LEVEL <= LOG_LEVEL_DEBUG) {\n      console.log(...args);\n    }\n  },\n\n  warn(...args) {\n    if (LOG_LEVEL <= LOG_LEVEL_WARN) {\n      console.warn(...args);\n    }\n  },\n\n  error(...args) {\n    if (LOG_LEVEL <= LOG_LEVEL_ERROR) {\n      console.error(...args);\n    }\n  },\n};\n\nexport default logger;\n","const NAME = 'QUALTRICS';\nconst CNameMapping = {\n  [NAME]: NAME,\n  Qualtrics: NAME,\n  qualtrics: NAME,\n};\n\nexport { NAME, CNameMapping };\n","/* eslint-disable no-var */\n/* eslint-disable new-cap */\n/* eslint-disable no-empty */\n/* eslint-disable no-unneeded-ternary */\n/* eslint-disable class-methods-use-this */\n/* eslint-disable no-nested-ternary */\n/* eslint-disable no-underscore-dangle */\n/* eslint-disable no-unused-expressions */\n// eslint-disable-next-line no-nested-ternary\n// eslint-disable-next-line class-methods-use-this\n\nimport logger from '../../utils/logUtil';\nimport { LOAD_ORIGIN } from '../../utils/ScriptLoader';\nimport { NAME } from './constants';\n\nclass Qualtrics {\n  constructor(config, analytics, destinationInfo) {\n    if (analytics.logLevel) {\n      logger.setLogLevel(analytics.logLevel);\n    }\n    this.name = NAME;\n    this.projectId = config.projectId;\n    this.brandId = config.brandId;\n    this.enableGenericPageTitle = config.enableGenericPageTitle;\n    this.areTransformationsConnected = destinationInfo && destinationInfo.areTransformationsConnected;\n    this.destinationId = destinationInfo && destinationInfo.destinationId;\n  }\n\n  init() {\n    logger.debug('===in init Qualtrics===');\n    if (!this.projectId) {\n      logger.debug('Project ID missing');\n      return;\n    }\n\n    if (!this.brandId) {\n      logger.debug('Brand ID missing');\n      return;\n    }\n\n    const projectIdFormatted = this.projectId.replace(/_/g, '').toLowerCase().trim();\n    const requestUrlFormatted = `https://${projectIdFormatted}-${this.brandId}.siteintercept.qualtrics.com/SIE/?Q_ZID=${this.projectId}`;\n    const requestIdFormatted = `QSI_S_${this.projectId}`;\n\n    (function () {\n      var g = function (e, h, f, g) {\n        this.get = function (a) {\n          for (var a = `${a}=`, c = document.cookie.split(';'), b = 0, e = c.length; b < e; b++) {\n            for (var d = c[b]; d.charAt(0) == ' '; ) d = d.substring(1, d.length);\n            if (d.indexOf(a) == 0) return d.substring(a.length, d.length);\n          }\n          return null;\n        };\n        this.set = function (a, c) {\n          var b = '';\n          var b = new Date();\n          b.setTime(b.getTime() + 6048e5);\n          b = `; expires=${b.toGMTString()}`;\n          document.cookie = `${a}=${c}${b}; path=/; `;\n        };\n        this.check = function () {\n          var a = this.get(f);\n          if (a) a = a.split(':');\n          else if (e != 100)\n            h == 'v' && (e = Math.random() >= e / 100 ? 0 : 100),\n              (a = [h, e, 0]),\n              this.set(f, a.join(':'));\n          else return !0;\n          var c = a[1];\n          if (c == 100) return !0;\n          switch (a[0]) {\n            case 'v':\n              return !1;\n            case 'r':\n              return (c = a[2] % Math.floor(100 / c)), a[2]++, this.set(f, a.join(':')), !c;\n          }\n          return !0;\n        };\n        this.go = function () {\n          if (this.check()) {\n            var a = document.createElement('script');\n            a.type = 'text/javascript';\n            a.setAttribute('data-loader', LOAD_ORIGIN);\n            a.src = g;\n            document.body && document.body.appendChild(a);\n          }\n        };\n        this.start = function () {\n          var t = this;\n          document.readyState !== 'complete'\n            ? window.addEventListener\n              ? window.addEventListener(\n                  'load',\n                  function () {\n                    t.go();\n                  },\n                  !1,\n                )\n              : window.attachEvent &&\n                window.attachEvent('onload', function () {\n                  t.go();\n                })\n            : t.go();\n        };\n      };\n      try {\n        new g(100, 'r', requestIdFormatted, requestUrlFormatted).start();\n      } catch (i) {}\n    })();\n\n    const div = document.createElement('div');\n    div.setAttribute('id', String(this.projectId));\n    window._qsie = window._qsie || [];\n    document.getElementsByTagName('head')[0].appendChild(div);\n  }\n\n  isLoaded() {\n    logger.debug('===in Qualtrics isLoaded===');\n    return !!(window._qsie && window.QSI && window.QSI.API);\n  }\n\n  isReady() {\n    logger.debug('===in Qualtrics isReady===');\n    return !!(window._qsie && window.QSI && window.QSI.API);\n  }\n\n  page(rudderElement) {\n    logger.debug('===in Qualtrics page===');\n    const { message } = rudderElement;\n    if (!message) {\n      logger.debug('Message field is missing');\n      return;\n    }\n\n    if (this.enableGenericPageTitle) {\n      window._qsie.push('Viewed a Page');\n      return;\n    }\n\n    const { name, category, properties } = message;\n    const categoryField =\n      category || (properties && properties.category ? properties.category : null);\n\n    if (!categoryField && !name) {\n      logger.debug('generic title is disabled and no name or category field found');\n      return;\n    }\n    const dynamicTitle =\n      categoryField && name ? `Viewed ${categoryField} ${name} Page` : `Viewed ${name} Page`;\n\n    window._qsie.push(dynamicTitle);\n  }\n\n  track(rudderElement) {\n    logger.debug('===in Qualtrics track===');\n    const { message } = rudderElement;\n    if (!message) {\n      logger.debug('Message field is missing');\n      return;\n    }\n    if (!message.event) {\n      logger.debug('Event field is undefined');\n      return;\n    }\n    window._qsie.push(message.event);\n  }\n}\nexport default Qualtrics;\n","/* eslint-disable no-use-before-define */\n// import logger from \"../utils/logUtil\";\n\nimport { handleError } from \"./errorHandler\";\n\nconst defaultAsyncState = true;\n\nexport const LOAD_ORIGIN = 'RS_JS_SDK';\n/**\n * Script loader\n * @param {String} id                               Id of the script\n * @param {String} src                              URL of the script\n * @param {Object} options                          Object containing different configuration\n * @param {Boolean} options.async                   Determines script will be loaded asynchronously or not\n * @param {Boolean} options.isNonNativeSDK          Determines whether the script that will be loaded is one of RS's own\n * @param {Boolean} options.skipDatasetAttributes   Determines whether to add or skip dataset attribute\n */\nconst ScriptLoader = (id, src, options = {}) => {\n  try {\n    const exists = document.getElementById(id);\n    if (exists) {\n      // logger.debug(\"script already loaded\");\n      return;\n    }\n\n    const js = document.createElement('script');\n    js.src = src;\n    js.async = options.async === undefined ? defaultAsyncState : options.async;\n    js.type = 'text/javascript';\n    js.id = id;\n    // This checking is in place to skip the dataset attribute for some cases(while loading polyfill)\n    if (options.skipDatasetAttributes !== true) {\n      js.setAttribute('data-loader', LOAD_ORIGIN);\n      if (options.isNonNativeSDK !== undefined) {\n        js.setAttribute('data-isNonNativeSDK', options.isNonNativeSDK);\n      }\n    }\n    const headElmColl = document.getElementsByTagName('head');\n    if (headElmColl.length > 0) {\n      // logger.debug(\"==adding script==\", js);\n      headElmColl[0].insertBefore(js, headElmColl[0].firstChild);\n    } else {\n      const e = document.getElementsByTagName('script')[0];\n      // logger.debug(\"==parent script==\", e);\n      // logger.debug(\"==adding script==\", js);\n      e.parentNode.insertBefore(js, e);\n    }\n  } catch (e) {\n    handleError(e);\n  }\n};\n\nexport default ScriptLoader;\n"],"names":["_CNameMapping","LOG_LEVEL","logger","logLevel","toUpperCase","_console2","console","log","apply","arguments","NAME","Qualtrics","config","analytics","destinationInfo","_classCallCheck","this","name","projectId","brandId","enableGenericPageTitle","areTransformationsConnected","destinationId","key","value","projectIdFormatted","replace","toLowerCase","trim","requestUrlFormatted","concat","requestIdFormatted","e","h","f","g","get","a","c","document","cookie","split","b","length","d","charAt","substring","indexOf","set","setTime","getTime","toGMTString","check","Math","random","join","floor","go","createElement","type","setAttribute","src","body","appendChild","start","t","readyState","window","addEventListener","attachEvent","i","div","String","_qsie","getElementsByTagName","QSI","API","rudderElement","message","push","category","properties","categoryField","dynamicTitle","event"],"mappings":"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"}