{"version":3,"file":"VWO.min.js","sources":["../../../src/utils/logUtil.js","../../../src/integrations/VWO/constants.js","../../../src/integrations/VWO/browser.js","../../../src/utils/ScriptLoader.js"],"sourcesContent":["const LOG_LEVEL_INFO = 1;\nconst LOG_LEVEL_DEBUG = 2;\nconst LOG_LEVEL_WARN = 3;\nconst LOG_LEVEL_ERROR = 4;\nconst DEF_LOG_LEVEL = LOG_LEVEL_ERROR;\nlet LOG_LEVEL = DEF_LOG_LEVEL;\n\nconst logger = {\n  setLogLevel(logLevel) {\n    switch (logLevel.toUpperCase()) {\n      case 'INFO':\n        LOG_LEVEL = LOG_LEVEL_INFO;\n        break;\n      case 'DEBUG':\n        LOG_LEVEL = LOG_LEVEL_DEBUG;\n        break;\n      case 'WARN':\n        LOG_LEVEL = LOG_LEVEL_WARN;\n        break;\n      default:\n        LOG_LEVEL = DEF_LOG_LEVEL;\n        break;\n    }\n  },\n\n  info(...args) {\n    if (LOG_LEVEL <= LOG_LEVEL_INFO) {\n      console.info(...args);\n    }\n  },\n\n  debug(...args) {\n    if (LOG_LEVEL <= LOG_LEVEL_DEBUG) {\n      console.log(...args);\n    }\n  },\n\n  warn(...args) {\n    if (LOG_LEVEL <= LOG_LEVEL_WARN) {\n      console.warn(...args);\n    }\n  },\n\n  error(...args) {\n    if (LOG_LEVEL <= LOG_LEVEL_ERROR) {\n      console.error(...args);\n    }\n  },\n};\n\nexport default logger;\n","const NAME = 'VWO';\nconst CNameMapping = {\n  [NAME]: NAME,\n  VisualWebsiteOptimizer: NAME,\n  Visualwebsiteoptimizer: NAME,\n  visualwebsiteoptimizer: NAME,\n  vwo: NAME,\n  'Visual Website Optimizer': NAME,\n  'Visual website optimizer': NAME,\n  'visual website optimizer': NAME,\n};\n\nexport { NAME, CNameMapping };\n","/* eslint-disable no-underscore-dangle */\n/* eslint-disable class-methods-use-this */\n/* eslint-disable camelcase */\nimport logger from '../../utils/logUtil';\nimport { LOAD_ORIGIN } from '../../utils/ScriptLoader';\nimport { NAME } from './constants';\n\nclass VWO {\n  constructor(config, analytics, destinationInfo) {\n    if (analytics.logLevel) {\n      logger.setLogLevel(analytics.logLevel);\n    }\n    this.accountId = config.accountId; // 1549611\n    this.settingsTolerance = config.settingsTolerance;\n    this.isSPA = config.isSPA;\n    this.libraryTolerance = config.libraryTolerance;\n    this.useExistingJquery = config.useExistingJquery;\n    this.sendExperimentTrack = config.sendExperimentTrack;\n    this.sendExperimentIdentify = config.sendExperimentIdentify;\n    this.name = NAME;\n    this.analytics = analytics;\n    this.areTransformationsConnected = destinationInfo && destinationInfo.areTransformationsConnected;\n    this.destinationId = destinationInfo && destinationInfo.destinationId;\n    logger.debug('Config ', config);\n  }\n\n  init() {\n    logger.debug('===In init VWO===');\n    if (this.analytics.loadOnlyIntegrations?.VWO?.loadIntegration) {\n      const account_id = this.accountId;\n      const settings_tolerance = this.settingsTolerance;\n      const library_tolerance = this.libraryTolerance;\n      const use_existing_jquery = this.useExistingJquery;\n      const { isSPA } = this;\n      window._vwo_code = (function () {\n        let f = false;\n        const d = document;\n        return {\n          use_existing_jquery() {\n            return use_existing_jquery;\n          },\n          library_tolerance() {\n            return library_tolerance;\n          },\n          finish() {\n            if (!f) {\n              f = true;\n              const a = d.getElementById('_vis_opt_path_hides');\n              if (a) a.parentNode.removeChild(a);\n            }\n          },\n          finished() {\n            return f;\n          },\n          load(a) {\n            const b = d.createElement('script');\n            b.src = a;\n            b.type = 'text/javascript';\n            b.setAttribute('data-loader', LOAD_ORIGIN);\n            b.innerText;\n            b.onerror = function () {\n              _vwo_code.finish();\n            };\n            d.getElementsByTagName('head')[0].appendChild(b);\n          },\n          init() {\n            const settings_timer = setTimeout('_vwo_code.finish()', settings_tolerance);\n            const a = d.createElement('style');\n            const b =\n              'body{opacity:0 !important;filter:alpha(opacity=0) !important;background:none !important;}';\n            const h = d.getElementsByTagName('head')[0];\n            a.setAttribute('id', '_vis_opt_path_hides');\n            a.setAttribute('type', 'text/css');\n            if (a.styleSheet) a.styleSheet.cssText = b;\n            else a.appendChild(d.createTextNode(b));\n            h.appendChild(a);\n            this.load(\n              `//dev.visualwebsiteoptimizer.com/j.php?a=${account_id}&u=${encodeURIComponent(\n                d.URL,\n              )}&r=${Math.random()}&f=${+isSPA}`,\n            );\n            return settings_timer;\n          },\n        };\n      })();\n      window._vwo_settings_timer = window._vwo_code.init();\n    } else {\n      logger.debug('===[VWO]loadIntegration flag is disabled===');\n    }\n    // Send track or iddentify when\n    if (this.sendExperimentTrack || this.experimentViewedIdentify) {\n      this.experimentViewed();\n    }\n  }\n\n  experimentViewed() {\n    window.VWO = window.VWO || [];\n    const self = this;\n    window.VWO.push([\n      'onVariationApplied',\n      (data) => {\n        if (!data) {\n          return;\n        }\n        logger.debug('Variation Applied');\n        const expId = data[1];\n        const variationId = data[2];\n        logger.debug(\n          'experiment id:',\n          expId,\n          'Variation Name:',\n          _vwo_exp[expId].comb_n[variationId],\n        );\n        if (\n          typeof _vwo_exp[expId].comb_n[variationId] !== 'undefined' &&\n          ['VISUAL_AB', 'VISUAL', 'SPLIT_URL', 'SURVEY'].indexOf(_vwo_exp[expId].type) > -1\n        ) {\n          try {\n            if (self.sendExperimentTrack) {\n              logger.debug('Tracking...');\n              this.analytics.track('Experiment Viewed', {\n                experimentId: expId,\n                variationName: _vwo_exp[expId].comb_n[variationId],\n              });\n            }\n          } catch (error) {\n            logger.error('[VWO] experimentViewed:: ', error);\n          }\n          try {\n            if (self.sendExperimentIdentify) {\n              logger.debug('Identifying...');\n              this.analytics.identify({\n                [`Experiment: ${expId}`]: _vwo_exp[expId].comb_n[variationId],\n              });\n            }\n          } catch (error) {\n            logger.error('[VWO] experimentViewed:: ', error);\n          }\n        }\n      },\n    ]);\n  }\n\n  identify() {\n    logger.debug('[VWO] identify:: method not supported');\n  }\n\n  track(rudderElement) {\n    logger.debug('===In VWO track===');\n    const eventName = rudderElement.message.event;\n    if (eventName === 'Order Completed') {\n      const total = rudderElement.message.properties\n        ? rudderElement.message.properties.total || rudderElement.message.properties.revenue\n        : 0;\n      logger.debug('Revenue', total);\n      window.VWO = window.VWO || [];\n      window.VWO.push(['track.revenueConversion', total]);\n    }\n  }\n\n  page() {\n    logger.debug('[VWO] page:: method not supported');\n  }\n\n  isLoaded() {\n    logger.debug('===In isLoaded VWO===');\n    return !!window._vwo_code;\n  }\n\n  isReady() {\n    logger.debug('===In isReady VWO===');\n    return !!window._vwo_code;\n  }\n}\n\nexport { VWO };\n","/* eslint-disable no-use-before-define */\n// import logger from \"../utils/logUtil\";\n\nimport { handleError } from \"./errorHandler\";\n\nconst defaultAsyncState = true;\n\nexport const LOAD_ORIGIN = 'RS_JS_SDK';\n/**\n * Script loader\n * @param {String} id                               Id of the script\n * @param {String} src                              URL of the script\n * @param {Object} options                          Object containing different configuration\n * @param {Boolean} options.async                   Determines script will be loaded asynchronously or not\n * @param {Boolean} options.isNonNativeSDK          Determines whether the script that will be loaded is one of RS's own\n * @param {Boolean} options.skipDatasetAttributes   Determines whether to add or skip dataset attribute\n */\nconst ScriptLoader = (id, src, options = {}) => {\n  try {\n    const exists = document.getElementById(id);\n    if (exists) {\n      // logger.debug(\"script already loaded\");\n      return;\n    }\n\n    const js = document.createElement('script');\n    js.src = src;\n    js.async = options.async === undefined ? defaultAsyncState : options.async;\n    js.type = 'text/javascript';\n    js.id = id;\n    // This checking is in place to skip the dataset attribute for some cases(while loading polyfill)\n    if (options.skipDatasetAttributes !== true) {\n      js.setAttribute('data-loader', LOAD_ORIGIN);\n      if (options.isNonNativeSDK !== undefined) {\n        js.setAttribute('data-isNonNativeSDK', options.isNonNativeSDK);\n      }\n    }\n    const headElmColl = document.getElementsByTagName('head');\n    if (headElmColl.length > 0) {\n      // logger.debug(\"==adding script==\", js);\n      headElmColl[0].insertBefore(js, headElmColl[0].firstChild);\n    } else {\n      const e = document.getElementsByTagName('script')[0];\n      // logger.debug(\"==parent script==\", e);\n      // logger.debug(\"==adding script==\", js);\n      e.parentNode.insertBefore(js, e);\n    }\n  } catch (e) {\n    handleError(e);\n  }\n};\n\nexport default ScriptLoader;\n"],"names":["_CNameMapping","LOG_LEVEL","logger","logLevel","toUpperCase","_console2","console","log","apply","arguments","_console4","error","NAME","_defineProperty","VWO","config","analytics","destinationInfo","_classCallCheck","this","accountId","settingsTolerance","isSPA","libraryTolerance","useExistingJquery","sendExperimentTrack","sendExperimentIdentify","name","areTransformationsConnected","destinationId","key","value","f","d","_this$analytics$loadO","loadOnlyIntegrations","_this$analytics$loadO2","loadIntegration","account_id","settings_tolerance","library_tolerance","use_existing_jquery","window","_vwo_code","document","finish","a","getElementById","parentNode","removeChild","finished","load","createElement","b","src","type","setAttribute","innerText","onerror","getElementsByTagName","appendChild","init","settings_timer","setTimeout","h","styleSheet","cssText","createTextNode","encodeURIComponent","URL","Math","random","concat","_vwo_settings_timer","experimentViewedIdentify","experimentViewed","_this","self","push","data","expId","variationId","_vwo_exp","comb_n","indexOf","track","experimentId","variationName","identify","rudderElement","message","event","properties","total","revenue"],"mappings":"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"}